// Mobile Menu Toggle
const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
const navMenu = document.querySelector('.nav-menu');

mobileMenuToggle.addEventListener('click', () => {
    navMenu.classList.toggle('active');
    mobileMenuToggle.classList.toggle('active');
});

// Close mobile menu when clicking on a link
const navLinks = document.querySelectorAll('.nav-menu a');
navLinks.forEach(link => {
    link.addEventListener('click', () => {
        navMenu.classList.remove('active');
        mobileMenuToggle.classList.remove('active');
    });
});

// Navbar scroll effect
let lastScroll = 0;
const navbar = document.getElementById('navbar');

window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset;

    if (currentScroll <= 0) {
        navbar.style.boxShadow = '0 2px 20px rgba(0, 0, 0, 0.1)';
    } else {
        navbar.style.boxShadow = '0 2px 30px rgba(0, 0, 0, 0.15)';
    }

    lastScroll = currentScroll;
});

// Removed email form handler - now using direct CTA buttons

// Booking Modal
const modal = document.getElementById('bookingModal');
const bookServiceButtons = document.querySelectorAll('.book-service');
const modalClose = document.querySelector('.modal-close');
const bookingForm = document.getElementById('bookingForm');
const serviceNameInput = document.getElementById('serviceName');

// Open modal when clicking service buttons
bookServiceButtons.forEach(button => {
    button.addEventListener('click', () => {
        const serviceName = button.getAttribute('data-service');
        serviceNameInput.value = serviceName;
        modal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Prevent scrolling
    });
});

// Close modal
function closeModal() {
    modal.classList.remove('active');
    document.body.style.overflow = ''; // Restore scrolling
}

modalClose.addEventListener('click', closeModal);

// Close modal when clicking outside
modal.addEventListener('click', (e) => {
    if (e.target === modal) {
        closeModal();
    }
});

// Close modal with Escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal.classList.contains('active')) {
        closeModal();
    }
});

// Handle form submission
bookingForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(bookingForm);
    const service = formData.get('service');
    const name = formData.get('name');
    const email = formData.get('email');
    const phone = formData.get('phone') || '';
    const message = formData.get('message');

    // Build Google Form URL with pre-filled data
    const baseURL = 'https://docs.google.com/forms/d/e/1FAIpQLSfbQOaSpdjNBvB_UzOL3Tm03vmTPaFDdJlsfk2M0D9-jqreqQ/viewform';

    const params = new URLSearchParams({
        'usp': 'pp_url',
        'entry.501105211': service,
        'entry.2005620554': name,
        'entry.1045781291': email,
        'entry.1166974658': phone,
        'entry.839337160': message
    });

    const googleFormURL = `${baseURL}?${params.toString()}`;

    // Open Google Form in new tab with pre-filled data
    window.open(googleFormURL, '_blank');

    // Show message
    alert(`Thank you, ${name}! Please click "Submit" on the Google Form to complete your booking.`);

    // Close modal and reset form
    closeModal();
    bookingForm.reset();
});


// Testimonials Slider
const testimonialCards = document.querySelectorAll('.testimonial-card');
const dots = document.querySelectorAll('.dot');
let currentTestimonial = 0;

function showTestimonial(index) {
    testimonialCards.forEach((card, i) => {
        card.classList.remove('active');
        dots[i].classList.remove('active');
    });

    testimonialCards[index].classList.add('active');
    dots[index].classList.add('active');
}

dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
        currentTestimonial = index;
        showTestimonial(index);
    });
});

// Auto-rotate testimonials every 5 seconds
setInterval(() => {
    currentTestimonial = (currentTestimonial + 1) % testimonialCards.length;
    showTestimonial(currentTestimonial);
}, 5000);

// Smooth scroll for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            const offsetTop = target.offsetTop - 80; // Account for fixed navbar
            window.scrollTo({
                top: offsetTop,
                behavior: 'smooth'
            });
        }
    });
});

// Intersection Observer for fade-in animations
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateY(0)';
        }
    });
}, observerOptions);

// Observe all cards and sections for animation
const animatedElements = document.querySelectorAll('.problem-card, .service-card, .blog-card');
animatedElements.forEach(el => {
    el.style.opacity = '0';
    el.style.transform = 'translateY(30px)';
    el.style.transition = 'opacity 0.6s ease-out, transform 0.6s ease-out';
    observer.observe(el);
});

// Add parallax effect to hero decoration
window.addEventListener('scroll', () => {
    const scrolled = window.pageYOffset;
    const heroDecoration = document.querySelector('.hero-decoration');
    if (heroDecoration) {
        heroDecoration.style.transform = `translateY(${scrolled * 0.3}px)`;
    }
});

// Console message for developers
console.log('%cüè° FengShuiWithJackson', 'color: #0d4d3d; font-size: 24px; font-weight: bold;');
console.log('%cAlign Your Space, Attract Your Wealth', 'color: #d4af37; font-size: 14px;');
console.log('%cWebsite by Modern Zen Design', 'color: #8a8a8a; font-size: 12px;');
// ==========================================
// ENHANCED FEATURES FOR FENGSHUIWITHJACKSON
// Dark Mode, Reading Progress, Share Buttons, 
// Related Articles, and More
// ==========================================

(function() {
    'use strict';

    // ==========================================
    // 1. DARK MODE
    // ==========================================
    const DarkMode = {
        init() {
            this.createToggle();
            this.loadPreference();
            this.watchSystemPreference();
        },

        createToggle() {
            const toggle = document.createElement('button');
            toggle.id = 'dark-mode-toggle';
            toggle.innerHTML = 'üåô';
            toggle.setAttribute('aria-label', 'Toggle dark mode');
            toggle.style.cssText = `
                position: fixed;
                bottom: 100px;
                right: 20px;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                border: none;
                background: var(--emerald-deep, #0d4d3d);
                color: white;
                font-size: 24px;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 999;
                transition: all 0.3s ease;
            `;
            toggle.addEventListener('click', () => this.toggle());
            toggle.addEventListener('mouseenter', () => {
                toggle.style.transform = 'scale(1.1)';
            });
            toggle.addEventListener('mouseleave', () => {
                toggle.style.transform = 'scale(1)';
            });
            document.body.appendChild(toggle);
        },

        toggle() {
            const isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDark ? 'true' : 'false');
            this.updateIcon(isDark);
        },

        loadPreference() {
            const saved = localStorage.getItem('darkMode');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const isDark = saved === 'true' || (saved === null && prefersDark);
            
            if (isDark) {
                document.body.classList.add('dark-mode');
            }
            this.updateIcon(isDark);
        },

        updateIcon(isDark) {
            const toggle = document.getElementById('dark-mode-toggle');
            if (toggle) {
                toggle.innerHTML = isDark ? '‚òÄÔ∏è' : 'üåô';
            }
        },

        watchSystemPreference() {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (localStorage.getItem('darkMode') === null) {
                    if (e.matches) {
                        document.body.classList.add('dark-mode');
                    } else {
                        document.body.classList.remove('dark-mode');
                    }
                    this.updateIcon(e.matches);
                }
            });
        }
    };

    // ==========================================
    // 2. READING PROGRESS BAR
    // ==========================================
    const ReadingProgress = {
        init() {
            if (!document.querySelector('.article-body, .article-content')) return;
            
            this.createProgressBar();
            this.bindEvents();
        },

        createProgressBar() {
            const bar = document.createElement('div');
            bar.id = 'reading-progress';
            bar.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 0%;
                height: 4px;
                background: linear-gradient(90deg, #d4af37, #e8c96f);
                z-index: 1001;
                transition: width 0.1s ease;
                box-shadow: 0 1px 5px rgba(212, 175, 55, 0.5);
            `;
            document.body.appendChild(bar);
        },

        bindEvents() {
            let ticking = false;
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        this.updateProgress();
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        },

        updateProgress() {
            const bar = document.getElementById('reading-progress');
            const article = document.querySelector('.article-body, .article-content');
            if (!bar || !article) return;

            const articleTop = article.offsetTop;
            const articleHeight = article.offsetHeight;
            const windowHeight = window.innerHeight;
            const scrollTop = window.pageYOffset;

            const start = articleTop - windowHeight;
            const end = articleTop + articleHeight;
            const progress = ((scrollTop - start) / (end - start)) * 100;
            
            bar.style.width = Math.min(Math.max(progress, 0), 100) + '%';
        }
    };

    // ==========================================
    // 3. ENHANCED SHARE BUTTONS
    // ==========================================
    const ShareButtons = {
        init() {
            this.createShareBar();
        },

        createShareBar() {
            const article = document.querySelector('.article-header');
            if (!article) return;

            const shareBar = document.createElement('div');
            shareBar.className = 'share-bar';
            shareBar.innerHTML = `
                <span class="share-label">Share:</span>
                <button class="share-btn share-facebook" data-platform="facebook" title="Share on Facebook">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"/>
                    </svg>
                </button>
                <button class="share-btn share-twitter" data-platform="twitter" title="Share on Twitter/X">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                    </svg>
                </button>
                <button class="share-btn share-pinterest" data-platform="pinterest" title="Pin on Pinterest">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.373 0 0 5.372 0 12c0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.631-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24 12 24c6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z"/>
                    </svg>
                </button>
                <button class="share-btn share-linkedin" data-platform="linkedin" title="Share on LinkedIn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                    </svg>
                </button>
                <button class="share-btn share-whatsapp" data-platform="whatsapp" title="Share on WhatsApp">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
                    </svg>
                </button>
                <button class="share-btn share-copy" data-platform="copy" title="Copy Link">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                    </svg>
                </button>
            `;
            
            // Insert after article header
            article.parentNode.insertBefore(shareBar, article.nextSibling);
            
            // Bind click events
            shareBar.querySelectorAll('.share-btn').forEach(btn => {
                btn.addEventListener('click', () => this.share(btn.dataset.platform));
            });
        },

        share(platform) {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent(document.title);
            const text = encodeURIComponent(document.querySelector('meta[name="description"]')?.content || '');
            
            const urls = {
                facebook: `https://www.facebook.com/sharer/sharer.php?u=${url}`,
                twitter: `https://twitter.com/intent/tweet?url=${url}&text=${title}`,
                pinterest: `https://pinterest.com/pin/create/button/?url=${url}&description=${title}`,
                linkedin: `https://www.linkedin.com/shareArticle?mini=true&url=${url}&title=${title}`,
                whatsapp: `https://wa.me/?text=${title}%20${url}`,
                copy: null
            };

            if (platform === 'copy') {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    this.showToast('Link copied to clipboard!');
                });
            } else if (urls[platform]) {
                window.open(urls[platform], '_blank', 'width=600,height=400');
            }
        },

        showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'share-toast';
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                background: #0d4d3d;
                color: white;
                padding: 15px 30px;
                border-radius: 30px;
                font-size: 14px;
                z-index: 9999;
                animation: toastIn 0.3s ease;
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }
    };

    // ==========================================
    // 4. RELATED ARTICLES ALGORITHM
    // ==========================================
    const RelatedArticles = {
        articles: [
            { url: 'article-2026-forecast.html', title: '2026 Feng Shui Forecast', category: '2026', tags: ['forecast', 'fire-horse', 'zodiac'] },
            { url: 'article-bedroom-fengshui.html', title: 'Bedroom Feng Shui Guide', category: 'bedroom', tags: ['bedroom', 'sleep', 'relationships'] },
            { url: 'article-bedroom-mistakes.html', title: '7 Bedroom Mistakes', category: 'bedroom', tags: ['bedroom', 'mistakes', 'tips'] },
            { url: 'article-kitchen-fengshui.html', title: 'Kitchen Feng Shui', category: 'kitchen', tags: ['kitchen', 'wealth', 'health'] },
            { url: 'article-office-fengshui.html', title: 'Office Feng Shui', category: 'office', tags: ['office', 'career', 'success'] },
            { url: 'article-home-office.html', title: 'Home Office Guide', category: 'office', tags: ['office', 'work-from-home', 'desk'] },
            { url: 'article-living-room-fengshui.html', title: 'Living Room Feng Shui', category: 'living-room', tags: ['living-room', 'family', 'gathering'] },
            { url: 'article-entryway-fengshui.html', title: 'Entryway Feng Shui', category: 'entryway', tags: ['entryway', 'chi', 'welcome'] },
            { url: 'article-mirror-fengshui.html', title: 'Mirror Feng Shui Guide', category: 'mirrors', tags: ['mirrors', 'placement', 'taboos'] },
            { url: 'article-plants-guide.html', title: '15 Best Feng Shui Plants', category: 'plants', tags: ['plants', 'nature', 'energy'] },
            { url: 'article-money-plants.html', title: 'Top 5 Money Plants', category: 'plants', tags: ['plants', 'money', 'wealth'] },
            { url: 'article-wealth-corner.html', title: 'Find Your Wealth Corner', category: 'wealth', tags: ['wealth', 'money', 'bagua'] },
            { url: 'article-decluttering.html', title: 'Decluttering Guide', category: 'decluttering', tags: ['decluttering', 'organization', 'chi'] },
            { url: 'article-fire-horse-2026.html', title: 'Fire Horse 2026', category: '2026', tags: ['fire-horse', '2026', 'energy'] }
        ],

        init() {
            this.enhanceRelatedSection();
        },

        getCurrentArticle() {
            const currentPath = window.location.pathname.split('/').pop();
            return this.articles.find(a => a.url === currentPath);
        },

        getRecommendations(current, limit = 3) {
            if (!current) return this.articles.slice(0, limit);

            const scores = this.articles
                .filter(a => a.url !== current.url)
                .map(article => {
                    let score = 0;
                    // Same category = high score
                    if (article.category === current.category) score += 10;
                    // Shared tags
                    const sharedTags = article.tags.filter(t => current.tags.includes(t));
                    score += sharedTags.length * 3;
                    return { ...article, score };
                })
                .sort((a, b) => b.score - a.score);

            return scores.slice(0, limit);
        },

        enhanceRelatedSection() {
            const relatedSection = document.querySelector('.related-articles-section .articles-grid');
            if (!relatedSection) return;

            const current = this.getCurrentArticle();
            const recommendations = this.getRecommendations(current);

            // Update with smart recommendations
            relatedSection.innerHTML = recommendations.map(article => `
                <article class="article-card" data-score="${article.score || 0}">
                    <div class="article-content">
                        <span class="article-tag">${article.category}</span>
                        <h3>${article.title}</h3>
                        <a href="${article.url}" class="read-more">Read More ‚Üí</a>
                    </div>
                </article>
            `).join('');
        }
    };

    // ==========================================
    // 5. ENHANCED BREADCRUMBS
    // ==========================================
    const Breadcrumbs = {
        init() {
            this.addSchema();
        },

        addSchema() {
            const breadcrumb = document.querySelector('.breadcrumb ol');
            if (!breadcrumb) return;

            const items = breadcrumb.querySelectorAll('li');
            const schemaData = {
                "@context": "https://schema.org",
                "@type": "BreadcrumbList",
                "itemListElement": []
            };

            items.forEach((item, index) => {
                const link = item.querySelector('a');
                const name = link ? link.textContent : item.textContent;
                const url = link ? link.href : window.location.href;
                
                schemaData.itemListElement.push({
                    "@type": "ListItem",
                    "position": index + 1,
                    "name": name.trim(),
                    "item": url
                });
            });

            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.textContent = JSON.stringify(schemaData);
            document.head.appendChild(script);
        }
    };

    // ==========================================
    // 6. ARTICLE SCHEMA MARKUP
    // ==========================================
    const ArticleSchema = {
        init() {
            if (!document.querySelector('.blog-article')) return;
            this.addSchema();
        },

        addSchema() {
            const article = document.querySelector('.blog-article');
            const title = document.querySelector('h1')?.textContent || document.title;
            const description = document.querySelector('meta[name="description"]')?.content || '';
            const datePublished = document.querySelector('.article-meta span')?.textContent?.replace('üìÖ ', '') || '';
            const author = 'Jackson';
            
            const schemaData = {
                "@context": "https://schema.org",
                "@type": "Article",
                "headline": title,
                "description": description,
                "author": {
                    "@type": "Person",
                    "name": author,
                    "url": "https://fengshuiwithjackson.com"
                },
                "publisher": {
                    "@type": "Organization",
                    "name": "Feng Shui With Jackson",
                    "logo": {
                        "@type": "ImageObject",
                        "url": "https://fengshuiwithjackson.com/images/logo.png"
                    }
                },
                "datePublished": this.parseDate(datePublished),
                "mainEntityOfPage": {
                    "@type": "WebPage",
                    "@id": window.location.href
                }
            };

            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.textContent = JSON.stringify(schemaData);
            document.head.appendChild(script);
        },

        parseDate(dateStr) {
            // Convert "January 2, 2026" to "2026-01-02"
            try {
                const date = new Date(dateStr);
                return date.toISOString().split('T')[0];
            } catch {
                return new Date().toISOString().split('T')[0];
            }
        }
    };

    // ==========================================
    // CSS STYLES FOR NEW FEATURES
    // ==========================================
    const Styles = {
        init() {
            const style = document.createElement('style');
            style.textContent = `
                /* Dark Mode */
                body.dark-mode {
                    --cream: #1a1a1a;
                    --cream-dark: #121212;
                    --white: #2d2d2d;
                    --black: #f0f0f0;
                    --gray-dark: #c0c0c0;
                    --gray-medium: #888;
                    --gray-light: #444;
                }
                
                body.dark-mode .navbar {
                    background: #1a1a1a;
                }
                
                body.dark-mode .service-card,
                body.dark-mode .blog-card,
                body.dark-mode .testimonial-card,
                body.dark-mode .article-body,
                body.dark-mode .sidebar-card {
                    background: #2d2d2d;
                }
                
                body.dark-mode h1, body.dark-mode h2, body.dark-mode h3,
                body.dark-mode h4, body.dark-mode h5, body.dark-mode h6 {
                    color: #4CAF50;
                }
                
                body.dark-mode .logo,
                body.dark-mode .nav-menu a {
                    color: #f0f0f0;
                }
                
                body.dark-mode img {
                    filter: brightness(0.9);
                }
                
                /* Share Bar */
                .share-bar {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    padding: 15px 0;
                    margin: 20px 0;
                    border-top: 1px solid var(--gray-light);
                    border-bottom: 1px solid var(--gray-light);
                    flex-wrap: wrap;
                }
                
                .share-label {
                    font-weight: 600;
                    color: var(--gray-dark);
                    margin-right: 10px;
                }
                
                .share-btn {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    border: none;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.3s ease;
                    color: white;
                }
                
                .share-facebook { background: #1877f2; }
                .share-twitter { background: #000; }
                .share-pinterest { background: #e60023; }
                .share-linkedin { background: #0a66c2; }
                .share-whatsapp { background: #25d366; }
                .share-copy { background: #0d4d3d; }
                
                .share-btn:hover {
                    transform: scale(1.15);
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                }
                
                /* Reading Progress Animation */
                @keyframes toastIn {
                    from { opacity: 0; transform: translate(-50%, 20px); }
                    to { opacity: 1; transform: translate(-50%, 0); }
                }
                
                /* Related Article Tag */
                .article-tag {
                    display: inline-block;
                    padding: 4px 12px;
                    background: var(--champagne-gold);
                    color: white;
                    font-size: 12px;
                    border-radius: 20px;
                    margin-bottom: 10px;
                    text-transform: capitalize;
                }
                
                /* Breadcrumb Enhancements */
                .breadcrumb ol {
                    display: flex;
                    flex-wrap: wrap;
                    list-style: none;
                    padding: 15px 0;
                    margin: 0;
                    font-size: 14px;
                }
                
                .breadcrumb li::after {
                    content: '‚Ä∫';
                    margin: 0 10px;
                    color: var(--gray-medium);
                }
                
                .breadcrumb li:last-child::after {
                    display: none;
                }
                
                .breadcrumb a {
                    color: var(--emerald-deep);
                    text-decoration: none;
                }
                
                .breadcrumb a:hover {
                    text-decoration: underline;
                }
            `;
            document.head.appendChild(style);
        }
    };

    // ==========================================
    // INITIALIZE ALL FEATURES
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
        Styles.init();
        DarkMode.init();
        ReadingProgress.init();
        ShareButtons.init();
        RelatedArticles.init();
        Breadcrumbs.init();
        ArticleSchema.init();
        
        console.log('%c‚ú® Enhanced Features Loaded', 'color: #d4af37; font-weight: bold;');
    });

})();
// ==========================================
// ADDITIONAL ENHANCEMENTS
// Back to Top, Exit Intent, Floating TOC, Print Styles
// ==========================================

(function () {
    'use strict';

    // ==========================================
    // 1. BACK TO TOP BUTTON
    // ==========================================
    const BackToTop = {
        init() {
            this.createButton();
            this.bindEvents();
        },

        createButton() {
            const btn = document.createElement('button');
            btn.id = 'back-to-top';
            btn.innerHTML = '‚Üë';
            btn.setAttribute('aria-label', 'Back to top');
            btn.style.cssText = `
                position: fixed;
                bottom: 30px;
                right: 20px;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                border: none;
                background: var(--champagne-gold, #d4af37);
                color: white;
                font-size: 24px;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 998;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            `;
            btn.addEventListener('click', () => this.scrollToTop());
            document.body.appendChild(btn);
        },

        bindEvents() {
            let ticking = false;
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        this.toggleVisibility();
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        },

        toggleVisibility() {
            const btn = document.getElementById('back-to-top');
            if (window.pageYOffset > 300) {
                btn.style.opacity = '1';
                btn.style.visibility = 'visible';
            } else {
                btn.style.opacity = '0';
                btn.style.visibility = 'hidden';
            }
        },

        scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
    };

    // ==========================================
    // 2. SMART POPUP (Multiple Trigger Conditions)
    // ==========================================
    const SmartPopup = {
        shown: false,
        scrollThreshold: 0.5, // 50% scroll depth
        timeThreshold: 30000, // 30 seconds on page
        lastScrollTop: 0,
        scrollUpCount: 0,

        init() {
            // Don't show if closed recently
            if (localStorage.getItem('exitPopupClosed')) {
                const closedTime = parseInt(localStorage.getItem('exitPopupClosed'));
                if (Date.now() - closedTime < 3 * 24 * 60 * 60 * 1000) return; // 3 days
            }

            this.createPopup();
            this.bindEvents();
        },

        createPopup() {
            const popup = document.createElement('div');
            popup.id = 'exit-popup';
            popup.innerHTML = `
                <div class="exit-popup-overlay"></div>
                <div class="exit-popup-content">
                    <button class="exit-popup-close">&times;</button>
                    <div class="exit-popup-icon">üéÅ</div>
                    <h2>Wait! Before You Go...</h2>
                    <p>Get your <strong>FREE 2026 Fire Horse Feng Shui Guide</strong> with room-by-room tips!</p>
                    <div class="exit-popup-features">
                        <span>‚úì Lucky Directions</span>
                        <span>‚úì Color Guide</span>
                        <span>‚úì Zodiac Forecast</span>
                    </div>
                    <a href="guide.html" class="exit-popup-btn">Get Free Guide ‚Üí</a>
                    <p class="exit-popup-secondary">Or check out our <a href="product-2026-guide.html">Premium 2026 Guide ($9.99)</a></p>
                    <button class="exit-popup-dismiss">No thanks, I'll figure it out myself</button>
                </div>
            `;
            document.body.appendChild(popup);
        },

        bindEvents() {
            // TRIGGER 1: Exit Intent (Desktop - mouse leaving top of page)
            document.addEventListener('mouseout', (e) => {
                if (e.clientY < 10 && !this.shown) {
                    this.show('exit_intent');
                }
            });

            // TRIGGER 2: Scroll-Up Intent (User scrolling back up quickly)
            let lastScrollTime = Date.now();
            window.addEventListener('scroll', () => {
                const currentScrollTop = window.pageYOffset;
                const scrollDirection = currentScrollTop < this.lastScrollTop ? 'up' : 'down';

                if (scrollDirection === 'up' && this.lastScrollTop - currentScrollTop > 200) {
                    this.scrollUpCount++;
                    if (this.scrollUpCount >= 2 && !this.shown) {
                        // User has scrolled up significantly multiple times
                        const scrollPercent = currentScrollTop / (document.body.scrollHeight - window.innerHeight);
                        if (scrollPercent > 0.3) { // Only if they've read 30%+ of page
                            this.show('scroll_up');
                        }
                    }
                }

                this.lastScrollTop = currentScrollTop;
            });

            // TRIGGER 3: Time on Page (30 seconds + 50% scroll)
            setTimeout(() => {
                const scrollPercent = window.pageYOffset / (document.body.scrollHeight - window.innerHeight);
                if (scrollPercent > this.scrollThreshold && !this.shown) {
                    this.show('time_scroll');
                }
            }, this.timeThreshold);

            // TRIGGER 4: Back Button Detection (using History API)
            history.pushState(null, null, location.href);
            window.addEventListener('popstate', () => {
                if (!this.shown) {
                    history.pushState(null, null, location.href);
                    this.show('back_button');
                }
            });

            // TRIGGER 5: Mobile - Page Visibility (switching tabs/apps)
            document.addEventListener('visibilitychange', () => {
                if (document.visibilityState === 'hidden' && !this.shown) {
                    // User is leaving - show popup when they return
                    this.pendingShow = true;
                }
                if (document.visibilityState === 'visible' && this.pendingShow && !this.shown) {
                    const scrollPercent = window.pageYOffset / (document.body.scrollHeight - window.innerHeight);
                    if (scrollPercent > 0.2) { // Only if engaged somewhat
                        setTimeout(() => this.show('visibility_return'), 1000);
                    }
                    this.pendingShow = false;
                }
            });

            // TRIGGER 6: Before Page Unload (last resort)
            window.addEventListener('beforeunload', (e) => {
                // Note: Can't show popup here, but can track
                if (!this.shown) {
                    // Track missed opportunity
                    console.log('User left without seeing popup');
                }
            });

            // Close buttons
            document.querySelector('.exit-popup-close')?.addEventListener('click', () => this.close());
            document.querySelector('.exit-popup-overlay')?.addEventListener('click', () => this.close());
            document.querySelector('.exit-popup-dismiss')?.addEventListener('click', () => this.close());

            // Escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') this.close();
            });
        },

        show(trigger = 'unknown') {
            if (this.shown) return;
            this.shown = true;
            const popup = document.getElementById('exit-popup');
            if (popup) {
                popup.classList.add('active');
                document.body.style.overflow = 'hidden';

                // Track which trigger worked
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'popup_shown', { 'trigger': trigger });
                }
                console.log('Popup triggered by:', trigger);
            }
        },

        close() {
            const popup = document.getElementById('exit-popup');
            if (popup) {
                popup.classList.remove('active');
                document.body.style.overflow = '';
                localStorage.setItem('exitPopupClosed', Date.now().toString());
            }
        }
    };

    // ==========================================
    // 3. FLOATING TABLE OF CONTENTS
    // ==========================================
    const FloatingTOC = {
        init() {
            const articleBody = document.querySelector('.article-body');
            const existingTOC = document.querySelector('.table-of-contents');
            if (!articleBody || !existingTOC) return;

            this.createFloatingTOC();
            this.bindEvents();
        },

        createFloatingTOC() {
            const headings = document.querySelectorAll('.article-body h2');
            if (headings.length < 3) return; // Only show for longer articles

            const toc = document.createElement('nav');
            toc.id = 'floating-toc';
            toc.innerHTML = `
                <div class="floating-toc-header">
                    <span>üìñ Contents</span>
                    <button class="floating-toc-toggle">‚àí</button>
                </div>
                <ul class="floating-toc-list">
                    ${Array.from(headings).map((h, i) => {
                const id = h.querySelector('span[id]')?.id || `section-${i}`;
                if (!h.querySelector('span[id]')) {
                    const span = document.createElement('span');
                    span.id = `section-${i}`;
                    h.prepend(span);
                }
                return `<li><a href="#${id}" data-index="${i}">${h.textContent.replace(/^\d+\.\s*/, '').substring(0, 30)}${h.textContent.length > 30 ? '...' : ''}</a></li>`;
            }).join('')}
                </ul>
            `;
            document.body.appendChild(toc);

            // Toggle functionality
            toc.querySelector('.floating-toc-toggle').addEventListener('click', () => {
                toc.classList.toggle('collapsed');
                toc.querySelector('.floating-toc-toggle').textContent =
                    toc.classList.contains('collapsed') ? '+' : '‚àí';
            });
        },

        bindEvents() {
            const headings = document.querySelectorAll('.article-body h2');
            const links = document.querySelectorAll('.floating-toc-list a');

            let ticking = false;
            window.addEventListener('scroll', () => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        this.updateActiveLink(headings, links);
                        this.toggleVisibility();
                        ticking = false;
                    });
                    ticking = true;
                }
            });

            // Smooth scroll for TOC links
            links.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const target = document.querySelector(link.getAttribute('href'));
                    if (target) {
                        window.scrollTo({
                            top: target.offsetTop - 100,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        },

        updateActiveLink(headings, links) {
            const scrollPos = window.pageYOffset + 150;
            let activeIndex = 0;

            headings.forEach((heading, i) => {
                if (heading.offsetTop <= scrollPos) {
                    activeIndex = i;
                }
            });

            links.forEach((link, i) => {
                link.classList.toggle('active', i === activeIndex);
            });
        },

        toggleVisibility() {
            const toc = document.getElementById('floating-toc');
            const articleBody = document.querySelector('.article-body');
            if (!toc || !articleBody) return;

            const articleTop = articleBody.offsetTop;
            const articleBottom = articleTop + articleBody.offsetHeight - 300;
            const scrollPos = window.pageYOffset;

            if (scrollPos > articleTop && scrollPos < articleBottom) {
                toc.classList.add('visible');
            } else {
                toc.classList.remove('visible');
            }
        }
    };

    // ==========================================
    // ADD STYLES
    // ==========================================
    const Styles = {
        init() {
            const style = document.createElement('style');
            style.textContent = `
                /* Back to Top Button Hover */
                #back-to-top:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
                }

                /* Exit Intent Popup */
                #exit-popup {
                    display: none;
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    z-index: 10000;
                }

                #exit-popup.active {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }

                .exit-popup-overlay {
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.7);
                    backdrop-filter: blur(3px);
                }

                .exit-popup-content {
                    position: relative;
                    background: white;
                    padding: 50px;
                    border-radius: 20px;
                    max-width: 500px;
                    width: 90%;
                    text-align: center;
                    animation: popupSlide 0.4s ease;
                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                }

                @keyframes popupSlide {
                    from { opacity: 0; transform: scale(0.9) translateY(-20px); }
                    to { opacity: 1; transform: scale(1) translateY(0); }
                }

                .exit-popup-close {
                    position: absolute;
                    top: 15px;
                    right: 20px;
                    background: none;
                    border: none;
                    font-size: 30px;
                    cursor: pointer;
                    color: #999;
                }

                .exit-popup-icon {
                    font-size: 60px;
                    margin-bottom: 20px;
                }

                .exit-popup-content h2 {
                    color: #0d4d3d;
                    margin-bottom: 15px;
                }

                .exit-popup-content p {
                    color: #666;
                    margin-bottom: 20px;
                }

                .exit-popup-features {
                    display: flex;
                    justify-content: center;
                    gap: 20px;
                    margin-bottom: 25px;
                    flex-wrap: wrap;
                }

                .exit-popup-features span {
                    background: #f0f7ff;
                    padding: 8px 15px;
                    border-radius: 20px;
                    font-size: 14px;
                    color: #0d4d3d;
                }

                .exit-popup-btn {
                    display: inline-block;
                    background: linear-gradient(135deg, #d4af37 0%, #e8c96f 100%);
                    color: white;
                    padding: 15px 40px;
                    border-radius: 30px;
                    text-decoration: none;
                    font-weight: 600;
                    font-size: 18px;
                    transition: all 0.3s ease;
                    margin-bottom: 15px;
                }

                .exit-popup-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
                }

                .exit-popup-secondary {
                    font-size: 14px;
                    color: #888;
                }

                .exit-popup-secondary a {
                    color: #d4af37;
                }

                .exit-popup-dismiss {
                    display: block;
                    margin: 15px auto 0;
                    background: none;
                    border: none;
                    color: #999;
                    font-size: 13px;
                    cursor: pointer;
                    text-decoration: underline;
                }

                /* Floating TOC */
                #floating-toc {
                    position: fixed;
                    left: 20px;
                    top: 50%;
                    transform: translateY(-50%);
                    background: white;
                    border-radius: 15px;
                    box-shadow: 0 5px 30px rgba(0,0,0,0.15);
                    padding: 15px;
                    max-width: 200px;
                    z-index: 100;
                    opacity: 0;
                    visibility: hidden;
                    transition: all 0.3s ease;
                }

                #floating-toc.visible {
                    opacity: 1;
                    visibility: visible;
                }

                #floating-toc.collapsed .floating-toc-list {
                    display: none;
                }

                .floating-toc-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    font-weight: 600;
                    color: #0d4d3d;
                    margin-bottom: 10px;
                    padding-bottom: 10px;
                    border-bottom: 1px solid #eee;
                }

                .floating-toc-toggle {
                    background: none;
                    border: none;
                    font-size: 18px;
                    cursor: pointer;
                    color: #0d4d3d;
                }

                .floating-toc-list {
                    list-style: none;
                    padding: 0;
                    margin: 0;
                }

                .floating-toc-list li {
                    margin: 8px 0;
                }

                .floating-toc-list a {
                    color: #666;
                    text-decoration: none;
                    font-size: 13px;
                    display: block;
                    padding: 5px 10px;
                    border-radius: 5px;
                    transition: all 0.2s ease;
                }

                .floating-toc-list a:hover,
                .floating-toc-list a.active {
                    background: #f0f7ff;
                    color: #0d4d3d;
                }

                .floating-toc-list a.active {
                    border-left: 3px solid #d4af37;
                }

                /* Print Styles */
                @media print {
                    .navbar, .footer, #dark-mode-toggle, #back-to-top,
                    #floating-toc, #exit-popup, .share-bar, .cta-box,
                    .article-cta, .affiliate-product, .sidebar-card,
                    .related-articles-section, .blog-newsletter,
                    .promo-banner, .pagination, .category-filter,
                    #reading-progress {
                        display: none !important;
                    }

                    body {
                        background: white !important;
                        color: black !important;
                        font-size: 12pt;
                        line-height: 1.5;
                    }

                    .article-body {
                        max-width: 100%;
                        padding: 0;
                    }

                    h1, h2, h3 {
                        color: black !important;
                        page-break-after: avoid;
                    }

                    img {
                        max-width: 100%;
                        page-break-inside: avoid;
                    }

                    a {
                        color: black !important;
                        text-decoration: underline;
                    }

                    a[href^="http"]::after {
                        content: " (" attr(href) ")";
                        font-size: 10pt;
                        color: #666;
                    }

                    .faq-section {
                        page-break-inside: avoid;
                    }

                    .faq-answer {
                        display: block !important;
                        max-height: none !important;
                    }

                    @page {
                        margin: 2cm;
                    }
                }

                /* Dark mode adjustments */
                body.dark-mode #floating-toc {
                    background: #2d2d2d;
                }

                body.dark-mode .floating-toc-header {
                    color: #4CAF50;
                    border-color: #444;
                }

                body.dark-mode .floating-toc-list a {
                    color: #ccc;
                }

                body.dark-mode .floating-toc-list a:hover,
                body.dark-mode .floating-toc-list a.active {
                    background: #333;
                    color: #4CAF50;
                }

                body.dark-mode .exit-popup-content {
                    background: #2d2d2d;
                }

                body.dark-mode .exit-popup-content h2 {
                    color: #4CAF50;
                }

                body.dark-mode .exit-popup-features span {
                    background: #333;
                    color: #ccc;
                }

                /* Responsive */
                @media (max-width: 1200px) {
                    #floating-toc {
                        display: none;
                    }
                }
            `;
            document.head.appendChild(style);
        }
    };

    // ==========================================
    // INITIALIZE
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
        Styles.init();
        BackToTop.init();
        // SmartPopup.init(); // DISABLED: Exit popup removed per user request
        FloatingTOC.init();

        console.log('%cüöÄ Additional Enhancements Loaded', 'color: #d4af37; font-weight: bold;');
    });

})();
// ==========================================
// FINAL ENHANCEMENTS
// Reading Time, Mobile Nav, Recently Viewed, Giscus
// ==========================================

(function () {
    'use strict';

    // ==========================================
    // 1. AUTO READING TIME CALCULATION
    // ==========================================
    const ReadingTime = {
        wordsPerMinute: 200, // Average reading speed

        init() {
            this.calculateAndDisplay();
        },

        calculateAndDisplay() {
            const articleBody = document.querySelector('.article-body');
            if (!articleBody) return;

            const text = articleBody.textContent || articleBody.innerText;
            const wordCount = text.trim().split(/\s+/).length;
            const readingTime = Math.ceil(wordCount / this.wordsPerMinute);

            // Find and update reading time display
            const metaElements = document.querySelectorAll('.article-meta span');
            metaElements.forEach(el => {
                if (el.textContent.includes('‚è±Ô∏è') || el.textContent.includes('min read')) {
                    el.textContent = `‚è±Ô∏è ${readingTime} min read`;
                    el.setAttribute('data-calculated', 'true');
                }
            });

            // Also update blog cards if on blog page
            const blogCards = document.querySelectorAll('.blog-card');
            blogCards.forEach(card => {
                const excerpt = card.querySelector('.blog-excerpt');
                if (excerpt) {
                    const cardText = excerpt.textContent;
                    const cardWords = cardText.trim().split(/\s+/).length;
                    // Estimate full article length (excerpt is ~10% of article)
                    const estimatedTime = Math.ceil((cardWords * 10) / this.wordsPerMinute);
                }
            });

            console.log(`Reading time: ${readingTime} minutes (${wordCount} words)`);
        }
    };

    // ==========================================
    // 2. MOBILE BOTTOM NAVIGATION BAR
    // ==========================================
    const MobileNav = {
        init() {
            if (window.innerWidth > 768) return; // Only on mobile
            this.createNav();
            this.bindEvents();
        },

        createNav() {
            const nav = document.createElement('nav');
            nav.id = 'mobile-bottom-nav';
            nav.innerHTML = `
                <a href="index.html" class="mobile-nav-item" data-page="home">
                    <span class="mobile-nav-icon">üè†</span>
                    <span class="mobile-nav-label">Home</span>
                </a>
                <a href="blog.html" class="mobile-nav-item" data-page="blog">
                    <span class="mobile-nav-icon">üìö</span>
                    <span class="mobile-nav-label">Blog</span>
                </a>
                <a href="fortune-calculator.html" class="mobile-nav-item" data-page="calculator">
                    <span class="mobile-nav-icon">üîÆ</span>
                    <span class="mobile-nav-label">Fortune</span>
                </a>
                <a href="daily-fortune.html" class="mobile-nav-item" data-page="daily">
                    <span class="mobile-nav-icon">‚ú®</span>
                    <span class="mobile-nav-label">Daily</span>
                </a>
                <a href="shop.html" class="mobile-nav-item" data-page="shop">
                    <span class="mobile-nav-icon">üõçÔ∏è</span>
                    <span class="mobile-nav-label">Shop</span>
                </a>
            `;
            document.body.appendChild(nav);

            // Highlight current page
            const currentPage = window.location.pathname.split('/').pop() || 'index.html';
            const pageMap = {
                'index.html': 'home',
                'blog.html': 'blog',
                'fortune-calculator.html': 'calculator',
                'daily-fortune.html': 'daily',
                'shop.html': 'shop'
            };
            const activeItem = nav.querySelector(`[data-page="${pageMap[currentPage]}"]`);
            if (activeItem) activeItem.classList.add('active');

            // Add padding to body to prevent content being hidden
            document.body.style.paddingBottom = '70px';
        },

        bindEvents() {
            // Hide on scroll down, show on scroll up
            let lastScroll = 0;
            const nav = document.getElementById('mobile-bottom-nav');

            window.addEventListener('scroll', () => {
                const currentScroll = window.pageYOffset;
                if (currentScroll > lastScroll && currentScroll > 200) {
                    nav.classList.add('hidden');
                } else {
                    nav.classList.remove('hidden');
                }
                lastScroll = currentScroll;
            });
        }
    };

    // ==========================================
    // 3. RECENTLY VIEWED ARTICLES
    // ==========================================
    const RecentlyViewed = {
        storageKey: 'recentlyViewedArticles',
        maxItems: 5,

        init() {
            this.trackCurrentArticle();
            this.displayWidget();
        },

        trackCurrentArticle() {
            // Only track article pages
            if (!document.querySelector('.blog-article')) return;

            const article = {
                url: window.location.pathname.split('/').pop(),
                title: document.querySelector('h1')?.textContent || document.title,
                category: document.querySelector('.article-category')?.textContent || 'General',
                timestamp: Date.now()
            };

            let viewed = this.getViewed();

            // Remove if already exists (will re-add at front)
            viewed = viewed.filter(a => a.url !== article.url);

            // Add to front
            viewed.unshift(article);

            // Keep only max items
            viewed = viewed.slice(0, this.maxItems);

            localStorage.setItem(this.storageKey, JSON.stringify(viewed));
        },

        getViewed() {
            try {
                return JSON.parse(localStorage.getItem(this.storageKey)) || [];
            } catch {
                return [];
            }
        },

        displayWidget() {
            const viewed = this.getViewed();
            const currentUrl = window.location.pathname.split('/').pop();

            // Filter out current page
            const others = viewed.filter(a => a.url !== currentUrl);

            if (others.length === 0) return;

            // Find sidebar to add widget
            const sidebar = document.querySelector('.article-sidebar');
            if (!sidebar) {
                // Create floating widget for non-article pages
                if (viewed.length > 1) {
                    this.createFloatingWidget(others);
                }
                return;
            }

            const widget = document.createElement('div');
            widget.className = 'sidebar-card recently-viewed-card';
            widget.innerHTML = `
                <h3>üìñ Recently Viewed</h3>
                <ul class="recently-viewed-list">
                    ${others.slice(0, 3).map(article => `
                        <li>
                            <a href="${article.url}">
                                <span class="rv-category">${article.category}</span>
                                <span class="rv-title">${article.title.substring(0, 40)}${article.title.length > 40 ? '...' : ''}</span>
                            </a>
                        </li>
                    `).join('')}
                </ul>
            `;
            sidebar.appendChild(widget);
        },

        createFloatingWidget(articles) {
            // Mini floating widget for blog listing page etc
            if (!document.querySelector('.blog-page')) return;

            const widget = document.createElement('div');
            widget.id = 'recently-viewed-float';
            widget.innerHTML = `
                <div class="rv-float-header">
                    <span>üìñ Continue Reading</span>
                    <button class="rv-float-close">√ó</button>
                </div>
                <a href="${articles[0].url}" class="rv-float-item">
                    ${articles[0].title.substring(0, 35)}...
                </a>
            `;
            document.body.appendChild(widget);

            // Show after 2 seconds
            setTimeout(() => widget.classList.add('show'), 2000);

            // Close button
            widget.querySelector('.rv-float-close').addEventListener('click', () => {
                widget.remove();
            });
        }
    };

    // ==========================================
    // 4. GISCUS COMMENTS SETUP
    // ==========================================
    const GiscusComments = {
        init() {
            // Only add to article pages
            if (!document.querySelector('.blog-article')) return;
            this.createCommentsSection();
        },

        createCommentsSection() {
            const articleBody = document.querySelector('.article-body');
            if (!articleBody) return;

            const commentsSection = document.createElement('section');
            commentsSection.className = 'comments-section';
            commentsSection.innerHTML = `
                <h2>üí¨ Comments & Discussion</h2>
                <p class="comments-intro">Share your feng shui experiences or ask questions below!</p>
                <div id="giscus-container">
                    <div class="giscus-placeholder">
                        <p>üí° <strong>Comments powered by GitHub Discussions</strong></p>
                        <p>To enable comments, the site owner needs to:</p>
                        <ol>
                            <li>Create a GitHub repository with Discussions enabled</li>
                            <li>Install the <a href="https://giscus.app" target="_blank">Giscus app</a></li>
                            <li>Update the configuration below</li>
                        </ol>
                        <button class="btn btn-outline" onclick="GiscusComments.loadGiscus()">Load Comments</button>
                    </div>
                </div>
            `;

            // Insert after article content, before sidebar
            const parentContainer = articleBody.parentElement;
            parentContainer.insertBefore(commentsSection, articleBody.nextSibling);
        },

        loadGiscus() {
            const container = document.getElementById('giscus-container');
            if (!container) return;

            // Note: User needs to configure these values
            const script = document.createElement('script');
            script.src = 'https://giscus.app/client.js';
            script.setAttribute('data-repo', 'OWNER/REPO'); // TODO: Update this
            script.setAttribute('data-repo-id', 'R_xxxxx'); // TODO: Update this
            script.setAttribute('data-category', 'Comments');
            script.setAttribute('data-category-id', 'DIC_xxxxx'); // TODO: Update this
            script.setAttribute('data-mapping', 'pathname');
            script.setAttribute('data-strict', '0');
            script.setAttribute('data-reactions-enabled', '1');
            script.setAttribute('data-emit-metadata', '0');
            script.setAttribute('data-input-position', 'top');
            script.setAttribute('data-theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            script.setAttribute('data-lang', 'en');
            script.setAttribute('crossorigin', 'anonymous');
            script.async = true;

            container.innerHTML = '';
            container.appendChild(script);
        }
    };

    // Make loadGiscus accessible globally
    window.GiscusComments = GiscusComments;

    // ==========================================
    // ADD STYLES
    // ==========================================
    const Styles = {
        init() {
            const style = document.createElement('style');
            style.textContent = `
                /* Mobile Bottom Navigation */
                #mobile-bottom-nav {
                    display: none;
                    position: fixed;
                    bottom: 0;
                    left: 0;
                    right: 0;
                    background: white;
                    box-shadow: 0 -2px 20px rgba(0,0,0,0.1);
                    z-index: 1000;
                    padding: 8px 0;
                    transition: transform 0.3s ease;
                }

                #mobile-bottom-nav.hidden {
                    transform: translateY(100%);
                }

                @media (max-width: 768px) {
                    #mobile-bottom-nav {
                        display: flex;
                        justify-content: space-around;
                    }
                }

                .mobile-nav-item {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    text-decoration: none;
                    color: #666;
                    padding: 5px 10px;
                    transition: all 0.2s ease;
                }

                .mobile-nav-item.active {
                    color: #0d4d3d;
                }

                .mobile-nav-item.active .mobile-nav-icon {
                    transform: scale(1.2);
                }

                .mobile-nav-icon {
                    font-size: 22px;
                    margin-bottom: 2px;
                    transition: transform 0.2s ease;
                }

                .mobile-nav-label {
                    font-size: 10px;
                    font-weight: 500;
                }

                /* Recently Viewed Widget */
                .recently-viewed-card {
                    background: #fff8e1 !important;
                    border: 1px solid #ffe082;
                }

                .recently-viewed-list {
                    list-style: none;
                    padding: 0;
                    margin: 0;
                }

                .recently-viewed-list li {
                    margin-bottom: 12px;
                    padding-bottom: 12px;
                    border-bottom: 1px solid #ffe082;
                }

                .recently-viewed-list li:last-child {
                    margin-bottom: 0;
                    padding-bottom: 0;
                    border-bottom: none;
                }

                .recently-viewed-list a {
                    text-decoration: none;
                    display: block;
                }

                .rv-category {
                    display: block;
                    font-size: 11px;
                    color: #d4af37;
                    font-weight: 600;
                    text-transform: uppercase;
                    margin-bottom: 3px;
                }

                .rv-title {
                    color: #333;
                    font-size: 14px;
                    line-height: 1.4;
                }

                .recently-viewed-list a:hover .rv-title {
                    color: #0d4d3d;
                }

                /* Floating Recently Viewed */
                #recently-viewed-float {
                    position: fixed;
                    bottom: 80px;
                    right: 20px;
                    background: white;
                    border-radius: 12px;
                    box-shadow: 0 5px 25px rgba(0,0,0,0.15);
                    padding: 15px;
                    max-width: 250px;
                    z-index: 999;
                    opacity: 0;
                    transform: translateY(20px);
                    transition: all 0.3s ease;
                }

                #recently-viewed-float.show {
                    opacity: 1;
                    transform: translateY(0);
                }

                .rv-float-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 10px;
                    font-weight: 600;
                    color: #0d4d3d;
                }

                .rv-float-close {
                    background: none;
                    border: none;
                    font-size: 20px;
                    cursor: pointer;
                    color: #999;
                }

                .rv-float-item {
                    display: block;
                    color: #666;
                    text-decoration: none;
                    font-size: 14px;
                    padding: 8px 12px;
                    background: #f5f5f5;
                    border-radius: 8px;
                }

                .rv-float-item:hover {
                    background: #e8f5e9;
                    color: #0d4d3d;
                }

                /* Comments Section - Fixed Layout */
                .comments-section {
                    margin-top: 50px;
                    padding: 40px;
                    border-top: 2px solid #e0e0e0;
                    max-width: 100%;
                    width: 100%;
                    box-sizing: border-box;
                    background: #f8f9fa;
                    border-radius: 20px;
                    margin-left: 0;
                    margin-right: 0;
                }

                .comments-section h2 {
                    color: #0d4d3d;
                    margin-bottom: 10px;
                    font-size: 1.5rem;
                }

                .comments-intro {
                    color: #666;
                    margin-bottom: 25px;
                }

                #giscus-container {
                    max-width: 100%;
                    overflow: hidden;
                }

                .giscus-placeholder {
                    background: white;
                    padding: 30px;
                    border-radius: 15px;
                    text-align: center;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
                }

                .giscus-placeholder ol {
                    text-align: left;
                    max-width: 400px;
                    margin: 20px auto;
                    padding-left: 20px;
                }

                .giscus-placeholder li {
                    margin-bottom: 10px;
                    color: #666;
                }

                .giscus-placeholder .btn {
                    margin-top: 15px;
                }

                /* Dark Mode */
                body.dark-mode #mobile-bottom-nav {
                    background: #1a1a1a;
                }

                body.dark-mode .mobile-nav-item {
                    color: #aaa;
                }

                body.dark-mode .mobile-nav-item.active {
                    color: #4CAF50;
                }

                body.dark-mode .recently-viewed-card {
                    background: #3d3d3d !important;
                    border-color: #555;
                }

                body.dark-mode .rv-title {
                    color: #eee;
                }

                body.dark-mode #recently-viewed-float {
                    background: #2d2d2d;
                }

                body.dark-mode .rv-float-item {
                    background: #3d3d3d;
                    color: #ccc;
                }

                body.dark-mode .giscus-placeholder {
                    background: #2d2d2d;
                }

                /* Hide mobile nav on desktop */
                @media (min-width: 769px) {
                    #mobile-bottom-nav {
                        display: none !important;
                    }
                    
                    body {
                        padding-bottom: 0 !important;
                    }
                }

                @media (max-width: 768px) {
                    #recently-viewed-float {
                        bottom: 90px;
                        right: 10px;
                        left: 10px;
                        max-width: none;
                    }
                }
            `;
            document.head.appendChild(style);
        }
    };

    // ==========================================
    // INITIALIZE
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
        Styles.init();
        ReadingTime.init();
        MobileNav.init();
        RecentlyViewed.init();
        GiscusComments.init();

        console.log('%cüìñ Final Enhancements Loaded', 'color: #0d4d3d; font-weight: bold;');
    });

})();
// ==========================================
// VISUAL ENHANCEMENTS - JavaScript
// Custom cursor, particles, scroll animations
// ==========================================

(function () {
    'use strict';

    // ==========================================
    // 1. CUSTOM CURSOR (Desktop Only)
    // ==========================================
    const CustomCursor = {
        init() {
            // Only on devices with fine pointer (mouse)
            if (!window.matchMedia('(hover: hover) and (pointer: fine)').matches) return;

            this.createCursor();
            this.bindEvents();
        },

        createCursor() {
            const cursor = document.createElement('div');
            cursor.className = 'custom-cursor';
            document.body.appendChild(cursor);

            const dot = document.createElement('div');
            dot.className = 'custom-cursor-dot';
            document.body.appendChild(dot);

            this.cursor = cursor;
            this.dot = dot;
        },

        bindEvents() {
            let mouseX = 0, mouseY = 0;
            let cursorX = 0, cursorY = 0;
            let dotX = 0, dotY = 0;

            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
            });

            // Smooth cursor follow
            const animate = () => {
                // Cursor follows with lag
                cursorX += (mouseX - cursorX) * 0.15;
                cursorY += (mouseY - cursorY) * 0.15;
                this.cursor.style.left = cursorX - 10 + 'px';
                this.cursor.style.top = cursorY - 10 + 'px';

                // Dot follows instantly
                dotX += (mouseX - dotX) * 0.5;
                dotY += (mouseY - dotY) * 0.5;
                this.dot.style.left = dotX - 2.5 + 'px';
                this.dot.style.top = dotY - 2.5 + 'px';

                requestAnimationFrame(animate);
            };
            animate();

            // Hover effect on interactive elements
            const interactiveElements = document.querySelectorAll('a, button, .btn, input, textarea, select, .blog-card, .service-card');
            interactiveElements.forEach(el => {
                el.addEventListener('mouseenter', () => {
                    this.cursor.classList.add('hover');
                });
                el.addEventListener('mouseleave', () => {
                    this.cursor.classList.remove('hover');
                });
            });

            // Hide cursor when leaving window
            document.addEventListener('mouseleave', () => {
                this.cursor.style.opacity = '0';
                this.dot.style.opacity = '0';
            });
            document.addEventListener('mouseenter', () => {
                this.cursor.style.opacity = '1';
                this.dot.style.opacity = '1';
            });
        }
    };

    // ==========================================
    // 2. FLOATING PARTICLES
    // ==========================================
    const Particles = {
        count: 15, // Number of particles

        init() {
            // Don't show on mobile or if reduced motion preferred
            if (window.innerWidth < 768) return;
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            this.createContainer();
            this.createParticles();
        },

        createContainer() {
            const container = document.createElement('div');
            container.className = 'particles-container';
            container.id = 'particles';
            document.body.appendChild(container);
            this.container = container;
        },

        createParticles() {
            for (let i = 0; i < this.count; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';

                // Random position and animation
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (15 + Math.random() * 20) + 's';
                particle.style.animationDelay = (Math.random() * 10) + 's';
                particle.style.opacity = (0.1 + Math.random() * 0.3).toString();
                particle.style.width = (2 + Math.random() * 4) + 'px';
                particle.style.height = particle.style.width;

                this.container.appendChild(particle);
            }
        }
    };

    // ==========================================
    // 3. SCROLL-TRIGGERED ANIMATIONS
    // ==========================================
    const ScrollAnimations = {
        init() {
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            this.observeElements();
        },

        observeElements() {
            const options = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('animated');
                        // Optional: unobserve after animation
                        // observer.unobserve(entry.target);
                    }
                });
            }, options);

            // Add animation class to elements
            const elementsToAnimate = document.querySelectorAll(
                '.section-title, .problem-card, .service-card, .blog-card, ' +
                '.testimonial-card, .article-cta, .faq-section, .sidebar-card, ' +
                '.fortune-item, .compatibility-section, .fortune-2026'
            );

            elementsToAnimate.forEach(el => {
                el.classList.add('animate-on-scroll');
                observer.observe(el);
            });
        }
    };

    // ==========================================
    // 4. PARALLAX EFFECTS
    // ==========================================
    const Parallax = {
        init() {
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
            if (window.innerWidth < 768) return; // Disable on mobile

            this.bindEvents();
        },

        bindEvents() {
            let ticking = false;

            window.addEventListener('scroll', () => {
                if (!ticking) {
                    requestAnimationFrame(() => {
                        this.updateParallax();
                        ticking = false;
                    });
                    ticking = true;
                }
            });
        },

        updateParallax() {
            const scrolled = window.pageYOffset;

            // Hero decoration parallax
            const heroDecoration = document.querySelector('.hero-decoration');
            if (heroDecoration) {
                heroDecoration.style.transform = `translateY(${scrolled * 0.3}px)`;
            }

            // Hero image subtle parallax
            const heroImage = document.querySelector('.image-placeholder');
            if (heroImage && scrolled < 800) {
                heroImage.style.transform = `translateY(${scrolled * 0.1}px)`;
            }
        }
    };

    // ==========================================
    // 5. MAGNETIC BUTTONS
    // ==========================================
    const MagneticButtons = {
        init() {
            if (window.innerWidth < 1024) return; // Desktop only

            const buttons = document.querySelectorAll('.btn-primary, .btn-gold');
            buttons.forEach(btn => this.addMagneticEffect(btn));
        },

        addMagneticEffect(btn) {
            btn.addEventListener('mousemove', (e) => {
                const rect = btn.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;

                btn.style.transform = `translate(${x * 0.2}px, ${y * 0.2}px)`;
            });

            btn.addEventListener('mouseleave', () => {
                btn.style.transform = 'translate(0, 0)';
            });
        }
    };

    // ==========================================
    // 6. TEXT REVEAL ANIMATION
    // ==========================================
    const TextReveal = {
        init() {
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            this.revealHeroText();
        },

        revealHeroText() {
            const heroTitle = document.querySelector('.hero-title');
            if (!heroTitle) return;

            // Add reveal class after a short delay
            setTimeout(() => {
                heroTitle.classList.add('revealed');
            }, 300);
        }
    };

    // ==========================================
    // 7. SMOOTH IMAGE LOADING
    // ==========================================
    const SmoothImageLoad = {
        init() {
            const images = document.querySelectorAll('img[loading="lazy"]');

            images.forEach(img => {
                img.style.opacity = '0';
                img.style.transition = 'opacity 0.5s ease';

                if (img.complete) {
                    img.style.opacity = '1';
                } else {
                    img.addEventListener('load', () => {
                        img.style.opacity = '1';
                    });
                }
            });
        }
    };

    // ==========================================
    // 8. TILT EFFECT ON CARDS
    // ==========================================
    const TiltCards = {
        init() {
            if (window.innerWidth < 1024) return; // Desktop only
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            const cards = document.querySelectorAll('.blog-card, .service-card');
            cards.forEach(card => this.addTiltEffect(card));
        },

        addTiltEffect(card) {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const centerX = rect.width / 2;
                const centerY = rect.height / 2;

                const rotateX = (y - centerY) / 20;
                const rotateY = (centerX - x) / 20;

                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-10px)`;
            });

            card.addEventListener('mouseleave', () => {
                card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) translateY(0)';
            });
        }
    };

    // ==========================================
    // 9. TYPING EFFECT FOR HEADINGS (Optional)
    // ==========================================
    const TypingEffect = {
        init() {
            // Only on homepage
            if (!document.querySelector('.hero-title')) return;
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            // This is optional - uncomment to enable
            // this.typeText();
        },

        typeText() {
            const title = document.querySelector('.hero-title');
            if (!title) return;

            const text = title.textContent;
            title.textContent = '';
            title.style.opacity = '1';

            let i = 0;
            const type = () => {
                if (i < text.length) {
                    title.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, 50);
                }
            };

            setTimeout(type, 500);
        }
    };

    // ==========================================
    // 10. CONFETTI ON SUCCESS (for calculator)
    // ==========================================
    const Confetti = {
        create(x, y) {
            const colors = ['#d4af37', '#0d4d3d', '#e8c96f', '#1a6b54'];

            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
                    position: fixed;
                    width: 10px;
                    height: 10px;
                    background: ${colors[Math.floor(Math.random() * colors.length)]};
                    left: ${x}px;
                    top: ${y}px;
                    pointer-events: none;
                    z-index: 10000;
                    border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
                `;
                document.body.appendChild(confetti);

                const angle = Math.random() * Math.PI * 2;
                const velocity = 5 + Math.random() * 10;
                const vx = Math.cos(angle) * velocity;
                const vy = Math.sin(angle) * velocity - 10;
                let opacity = 1;
                let posX = x;
                let posY = y;
                let velY = vy;

                const animate = () => {
                    posX += vx;
                    velY += 0.5; // gravity
                    posY += velY;
                    opacity -= 0.02;

                    confetti.style.left = posX + 'px';
                    confetti.style.top = posY + 'px';
                    confetti.style.opacity = opacity;
                    confetti.style.transform = `rotate(${posX}deg)`;

                    if (opacity > 0) {
                        requestAnimationFrame(animate);
                    } else {
                        confetti.remove();
                    }
                };

                requestAnimationFrame(animate);
            }
        }
    };

    // Make confetti globally available
    window.Confetti = Confetti;

    // ==========================================
    // 11. CLICKABLE BLOG CARDS
    // ==========================================
    const ClickableCards = {
        init() {
            this.makeCardsClickable();
            this.addHoverStyles();
        },

        makeCardsClickable() {
            const blogCards = document.querySelectorAll('.blog-card');

            blogCards.forEach(card => {
                const link = card.querySelector('.blog-link');
                if (!link) return;

                const href = link.getAttribute('href');

                // Make the entire card clickable
                card.style.cursor = 'pointer';

                // Make image clickable
                const image = card.querySelector('.blog-image');
                if (image) {
                    image.style.cursor = 'pointer';
                    image.addEventListener('click', (e) => {
                        e.preventDefault();
                        window.location.href = href;
                    });
                }

                // Make title clickable
                const title = card.querySelector('h3');
                if (title) {
                    title.style.cursor = 'pointer';
                    title.addEventListener('click', (e) => {
                        e.preventDefault();
                        window.location.href = href;
                    });
                }

                // Make card background clickable (but not the link itself to avoid double navigation)
                card.addEventListener('click', (e) => {
                    // Don't navigate if clicking on the actual link
                    if (e.target.classList.contains('blog-link') || e.target.closest('.blog-link')) {
                        return;
                    }
                    // Don't navigate if clicking on category tag
                    if (e.target.classList.contains('blog-category')) {
                        return;
                    }
                    e.preventDefault();
                    window.location.href = href;
                });
            });

            // Also make index page blog cards clickable
            const indexBlogCards = document.querySelectorAll('.blog .blog-card');
            indexBlogCards.forEach(card => {
                const link = card.querySelector('a[href*="article"]');
                if (!link) return;

                const href = link.getAttribute('href');
                card.style.cursor = 'pointer';

                card.addEventListener('click', (e) => {
                    if (e.target.tagName === 'A') return;
                    window.location.href = href;
                });
            });
        },

        addHoverStyles() {
            // Add visual feedback that cards are clickable
            const style = document.createElement('style');
            style.textContent = `
                .blog-card {
                    cursor: pointer;
                }
                
                .blog-card .blog-image {
                    cursor: pointer;
                }
                
                .blog-card h3 {
                    cursor: pointer;
                    transition: color 0.3s ease;
                }
                
                .blog-card:hover h3 {
                    color: var(--champagne-gold, #d4af37);
                }
                
                .blog-card .blog-image::after {
                    content: 'üëÅÔ∏è Read Article';
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%) scale(0.8);
                    background: rgba(13, 77, 61, 0.9);
                    color: white;
                    padding: 12px 24px;
                    border-radius: 30px;
                    font-weight: 600;
                    font-size: 14px;
                    opacity: 0;
                    transition: all 0.3s ease;
                    pointer-events: none;
                    z-index: 10;
                }
                
                .blog-card:hover .blog-image::after {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1);
                }
            `;
            document.head.appendChild(style);
        }
    };

    // ==========================================
    // INITIALIZE ALL EFFECTS
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize all visual enhancements
        CustomCursor.init();
        Particles.init();
        ScrollAnimations.init();
        Parallax.init();
        MagneticButtons.init();
        TextReveal.init();
        SmoothImageLoad.init();
        TiltCards.init();
        TypingEffect.init();
        ClickableCards.init();

        console.log('%c‚ú® Visual Enhancements Loaded', 'color: #d4af37; font-weight: bold; font-size: 14px;');
    });

})();
// ==========================================
// SEO AND NAVIGATION ENHANCEMENTS
// Product Schema, Search Enhancement, Breadcrumbs
// ==========================================

(function () {
    'use strict';

    // ==========================================
    // 1. PRODUCT SCHEMA FOR SHOP PAGE
    // ==========================================
    const ProductSchema = {
        init() {
            if (!window.location.pathname.includes('shop.html')) return;
            this.addProductSchemas();
        },

        addProductSchemas() {
            const products = [
                {
                    name: "Natural Healing Crystals Set",
                    description: "Crystal set for wealth attraction and energy healing. Perfect for feng shui wealth corner.",
                    price: "24.99",
                    category: "Crystals",
                    image: "images/product-crystals.webp",
                    url: "https://amzn.to/4jhTQZs"
                },
                {
                    name: "Money Tree (Pachira Aquatica)",
                    description: "Living prosperity plant with braided trunk symbolizing locked-in fortune. Easy care feng shui essential.",
                    price: "29.99",
                    category: "Plants",
                    image: "images/product-money-tree.webp",
                    url: "https://amzn.to/4shDmVb"
                },
                {
                    name: "Ceramic Tabletop Fountain",
                    description: "Water feature for wealth activation. Flowing water symbolizes cash flow and continuous income.",
                    price: "39.99",
                    category: "Decor",
                    image: "images/product-fountain.webp",
                    url: "https://amzn.to/4b6QcPQ"
                },
                {
                    name: "Wind Chimes Amazing Grace",
                    description: "Metal wind chimes for dispersing stagnant energy and inviting fresh Chi into your space.",
                    price: "34.99",
                    category: "Sound Tools",
                    image: "images/product-wind-chimes.webp",
                    url: "https://amzn.to/4q09n2y"
                },
                {
                    name: "Protection Crystals Set",
                    description: "Black Obsidian, Tourmaline, Labradorite, Smoky Quartz & Selenite for protection and energy cleansing.",
                    price: "29.99",
                    category: "Crystals",
                    image: "images/product-protection-crystals.webp",
                    url: "https://amzn.to/4jjMkgA"
                },
                {
                    name: "Zen Garden Kit",
                    description: "Miniature meditation tool for stress relief and mental clarity. Desktop feng shui essential.",
                    price: "24.99",
                    category: "Meditation",
                    image: "images/product-zen-garden.webp",
                    url: "https://amzn.to/49e0P0K"
                },
                {
                    name: "100% Mulberry Silk Pillowcase (22 Momme)",
                    description: "Luxury silk pillowcase for restful sleep and harmonious energy. Smooth fortune symbolism.",
                    price: "39.99",
                    category: "Bedroom",
                    image: "images/product-silk-pillowcase.webp",
                    url: "https://amzn.to/4qx8mPq"
                },
                {
                    name: "Himalayan Salt Lamp",
                    description: "Natural salt lamp releasing negative ions to purify energy and neutralize electromagnetic pollution.",
                    price: "24.99",
                    category: "Lighting",
                    image: "images/product-salt-lamp.webp",
                    url: "https://amzn.to/4jjEZxy"
                },
                {
                    name: "Tibetan Singing Bowl",
                    description: "Handcrafted singing bowl for sound healing and energy cleansing. Dissolves negative afflictions.",
                    price: "34.99",
                    category: "Sound Tools",
                    image: "images/product-singing-bowl.webp",
                    url: "https://amzn.to/4jeaY2h"
                },
                {
                    name: "Brass Gold Mini Table Lamps",
                    description: "Fire and Metal element activation for fame and wealth. Perfect desk feng shui tool.",
                    price: "44.99",
                    category: "Lighting",
                    image: "images/product-brass-lamp.webp",
                    url: "https://amzn.to/48WgMdb"
                },
                {
                    name: "Wood Desk Organizer",
                    description: "Natural wood organizer bringing grounding energy for steady career advancement.",
                    price: "39.99",
                    category: "Office",
                    image: "images/product-wood-organizer.webp",
                    url: "https://amzn.to/4jd85yq"
                },
                {
                    name: "White Sage Smudge Sticks",
                    description: "Essential space clearing tool for removing negative energy and preparing for new opportunities.",
                    price: "19.99",
                    category: "Cleansing",
                    image: "images/product-sage-sticks.webp",
                    url: "https://amzn.to/3MNVZ2Z"
                }
            ];

            // Create ItemList Schema
            const itemListSchema = {
                "@context": "https://schema.org",
                "@type": "ItemList",
                "name": "Jackson's Favorite Feng Shui Products",
                "description": "Curated feng shui essentials for wealth, harmony, and positive energy",
                "numberOfItems": products.length,
                "itemListElement": products.map((product, index) => ({
                    "@type": "ListItem",
                    "position": index + 1,
                    "item": {
                        "@type": "Product",
                        "name": product.name,
                        "description": product.description,
                        "image": `https://fengshuiwithjackson.com/${product.image}`,
                        "category": product.category,
                        "offers": {
                            "@type": "Offer",
                            "url": product.url,
                            "priceCurrency": "USD",
                            "price": product.price,
                            "availability": "https://schema.org/InStock",
                            "seller": {
                                "@type": "Organization",
                                "name": "Amazon"
                            }
                        },
                        "aggregateRating": {
                            "@type": "AggregateRating",
                            "ratingValue": "4.5",
                            "reviewCount": "100"
                        }
                    }
                }))
            };

            // Inject schema
            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.textContent = JSON.stringify(itemListSchema);
            document.head.appendChild(script);

            console.log('‚úÖ Product Schema added for', products.length, 'products');
        }
    };

    // ==========================================
    // 2. ENHANCED SEARCH WITH HIGHLIGHTING
    // ==========================================
    const EnhancedSearch = {
        init() {
            this.enhanceSearchResults();
            this.addSearchStyles();
        },

        enhanceSearchResults() {
            // Override the displayResults function if it exists
            const originalDisplayResults = window.displayResults;

            // Find and modify search results display
            const searchResults = document.getElementById('searchResults');
            if (!searchResults) return;

            // Add observer to enhance results when they appear
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.addedNodes.length > 0) {
                        this.highlightMatches();
                    }
                });
            });

            observer.observe(searchResults, { childList: true, subtree: true });
        },

        highlightMatches() {
            const searchBox = document.getElementById('siteSearch');
            const searchResults = document.getElementById('searchResults');
            if (!searchBox || !searchResults) return;

            const query = searchBox.value.trim().toLowerCase();
            if (query.length < 2) return;

            // Find all text nodes and highlight matches
            const resultItems = searchResults.querySelectorAll('.search-result-item');
            resultItems.forEach(item => {
                const titleEl = item.querySelector('.search-result-title');
                const excerptEl = item.querySelector('.search-result-excerpt');

                if (titleEl) {
                    titleEl.innerHTML = this.highlight(titleEl.textContent, query);
                }
                if (excerptEl) {
                    excerptEl.innerHTML = this.highlight(excerptEl.textContent, query);
                }
            });
        },

        highlight(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<mark class="search-highlight">$1</mark>');
        },

        addSearchStyles() {
            const style = document.createElement('style');
            style.textContent = `
                /* Enhanced Search Styles */
                .search-highlight {
                    background: linear-gradient(135deg, #fff3cd, #ffe082);
                    color: #0d4d3d;
                    padding: 2px 4px;
                    border-radius: 3px;
                    font-weight: 600;
                }

                .search-container {
                    position: relative;
                }

                .search-box {
                    padding: 10px 40px 10px 15px;
                    border: 2px solid #e0e0e0;
                    border-radius: 25px;
                    font-size: 14px;
                    width: 200px;
                    transition: all 0.3s ease;
                    background: white;
                }

                .search-box:focus {
                    outline: none;
                    border-color: var(--champagne-gold, #d4af37);
                    box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.2);
                    width: 280px;
                }

                .search-icon {
                    position: absolute;
                    right: 15px;
                    top: 50%;
                    transform: translateY(-50%);
                    pointer-events: none;
                }

                .search-results {
                    position: absolute;
                    top: calc(100% + 10px);
                    left: 0;
                    right: 0;
                    background: white;
                    border-radius: 15px;
                    box-shadow: 0 10px 40px rgba(0,0,0,0.15);
                    display: none;
                    z-index: 1000;
                    max-height: 400px;
                    overflow-y: auto;
                }

                .search-results.active {
                    display: block;
                }

                .search-result-item {
                    padding: 15px 20px;
                    border-bottom: 1px solid #f0f0f0;
                    text-decoration: none;
                    display: block;
                    transition: background 0.2s ease;
                }

                .search-result-item:last-child {
                    border-bottom: none;
                }

                .search-result-item:hover {
                    background: #f8f9fa;
                }

                .search-result-title {
                    color: #0d4d3d;
                    font-weight: 600;
                    font-size: 15px;
                    margin-bottom: 5px;
                }

                .search-result-excerpt {
                    color: #666;
                    font-size: 13px;
                    line-height: 1.4;
                }

                .search-no-results {
                    padding: 20px;
                    text-align: center;
                    color: #888;
                }

                /* Dark mode */
                body.dark-mode .search-box {
                    background: #2d2d2d;
                    border-color: #444;
                    color: #eee;
                }

                body.dark-mode .search-results {
                    background: #2d2d2d;
                }

                body.dark-mode .search-result-item:hover {
                    background: #3d3d3d;
                }

                body.dark-mode .search-result-title {
                    color: #4CAF50;
                }

                body.dark-mode .search-result-excerpt {
                    color: #bbb;
                }

                body.dark-mode .search-highlight {
                    background: rgba(212, 175, 55, 0.3);
                }

                /* Mobile */
                @media (max-width: 768px) {
                    .nav-search {
                        display: none;
                    }
                }
            `;
            document.head.appendChild(style);
        }
    };

    // ==========================================
    // 3. UNIFIED BREADCRUMB NAVIGATION
    // ==========================================
    const BreadcrumbEnhance = {
        init() {
            this.addBreadcrumbStyles();
            this.fixBreadcrumbPosition();
            this.addBreadcrumbSchema();
        },

        addBreadcrumbStyles() {
            const style = document.createElement('style');
            style.textContent = `
                /* Enhanced Breadcrumb Styles */
                .breadcrumb {
                    position: absolute;
                    top: 80px;
                    left: 50%;
                    transform: translateX(-50%);
                    z-index: 100;
                    padding: 0;
                    margin: 0;
                    display: none;
                }

                /* Show breadcrumb on pages with page-header or article-header */
                .page-header ~ .breadcrumb,
                .article-header ~ .breadcrumb,
                body:has(.page-header) .breadcrumb,
                body:has(.article-header) .breadcrumb {
                    display: block;
                }

                /* Breadcrumb inside navbar - needs repositioning */
                .navbar .breadcrumb {
                    position: relative;
                    top: auto;
                    left: auto;
                    transform: none;
                    background: rgba(13, 77, 61, 0.1);
                    padding: 8px 20px;
                    border-radius: 25px;
                    margin-bottom: 10px;
                    display: inline-block;
                }

                .breadcrumb ol {
                    list-style: none;
                    padding: 0;
                    margin: 0;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    font-size: 13px;
                }

                .breadcrumb li {
                    display: flex;
                    align-items: center;
                }

                .breadcrumb li:not(:last-child)::after {
                    content: '‚Ä∫';
                    margin-left: 10px;
                    color: rgba(13, 77, 61, 0.5);
                    font-weight: bold;
                }

                .breadcrumb a {
                    color: var(--emerald-deep, #0d4d3d);
                    text-decoration: none;
                    transition: color 0.2s ease;
                }

                .breadcrumb a:hover {
                    color: var(--champagne-gold, #d4af37);
                }

                .breadcrumb li[aria-current="page"] {
                    color: #888;
                    font-weight: 500;
                }

                /* Breadcrumb below header */
                .article-header + .container .breadcrumb,
                .page-header + .container .breadcrumb {
                    margin-top: 20px;
                    margin-bottom: 30px;
                }

                /* Breadcrumb in page header */
                .page-header .breadcrumb,
                .article-header .breadcrumb {
                    background: rgba(255, 255, 255, 0.1);
                    backdrop-filter: blur(10px);
                    margin-top: 20px;
                }

                .page-header .breadcrumb a,
                .article-header .breadcrumb a {
                    color: rgba(255, 255, 255, 0.8);
                }

                .page-header .breadcrumb a:hover,
                .article-header .breadcrumb a:hover {
                    color: var(--champagne-gold);
                }

                .page-header .breadcrumb li[aria-current="page"],
                .article-header .breadcrumb li[aria-current="page"] {
                    color: white;
                }

                .page-header .breadcrumb li:not(:last-child)::after,
                .article-header .breadcrumb li:not(:last-child)::after {
                    color: rgba(255, 255, 255, 0.5);
                }

                /* Dark mode */
                body.dark-mode .navbar .breadcrumb {
                    background: rgba(255, 255, 255, 0.1);
                }

                body.dark-mode .breadcrumb a {
                    color: #4CAF50;
                }

                body.dark-mode .breadcrumb li[aria-current="page"] {
                    color: #bbb;
                }

                /* Responsive */
                @media (max-width: 768px) {
                    .breadcrumb {
                        font-size: 12px;
                    }

                    .navbar .breadcrumb {
                        padding: 6px 15px;
                    }
                }
            `;
            document.head.appendChild(style);
        },

        fixBreadcrumbPosition() {
            // Only move breadcrumb for article pages, not general page headers
            // This prevents the breadcrumb from overlapping with the title
            const breadcrumb = document.querySelector('.navbar .breadcrumb');
            const articleHeader = document.querySelector('.article-header .container');

            // Only reposition for article pages, NOT for page-header (like blog.html)
            if (breadcrumb && articleHeader) {
                // Clone and move to article header only
                const clone = breadcrumb.cloneNode(true);
                articleHeader.insertBefore(clone, articleHeader.firstChild);
                breadcrumb.style.display = 'none';
            } else if (breadcrumb) {
                // For page-header pages, just hide the navbar breadcrumb completely
                breadcrumb.style.display = 'none';
            }
        },

        addBreadcrumbSchema() {
            // Check if schema already exists
            if (document.querySelector('script[type="application/ld+json"][data-breadcrumb]')) return;

            const breadcrumb = document.querySelector('.breadcrumb ol');
            if (!breadcrumb) return;

            const items = breadcrumb.querySelectorAll('li');
            const breadcrumbList = [];

            items.forEach((item, index) => {
                const link = item.querySelector('a');
                const name = link ? link.textContent : item.textContent.trim();
                const url = link ? link.href : window.location.href;

                breadcrumbList.push({
                    "@type": "ListItem",
                    "position": index + 1,
                    "name": name,
                    "item": url
                });
            });

            const schema = {
                "@context": "https://schema.org",
                "@type": "BreadcrumbList",
                "itemListElement": breadcrumbList
            };

            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.setAttribute('data-breadcrumb', 'true');
            script.textContent = JSON.stringify(schema);
            document.head.appendChild(script);
        }
    };

    // ==========================================
    // INITIALIZE
    // ==========================================
    document.addEventListener('DOMContentLoaded', () => {
        ProductSchema.init();
        EnhancedSearch.init();
        BreadcrumbEnhance.init();

        console.log('%cüîç SEO & Navigation Enhancements Loaded', 'color: #0d4d3d; font-weight: bold;');
    });

})();
// Enhanced Social Share Functionality
// Works on all article pages with floating sidebar and inline share options
(function () {
    'use strict';

    const SITE_NAME = 'Feng Shui With Jackson';

    function isArticlePage() {
        // Check if this is an article page by URL or content
        const url = window.location.pathname;
        return url.includes('article-') ||
            document.querySelector('.article-content') ||
            document.querySelector('.blog-article') ||
            document.querySelector('article');
    }

    function createFloatingShareBar() {
        // Only add on article pages
        if (!isArticlePage()) return;

        const shareContainer = document.createElement('div');
        shareContainer.className = 'social-share-floating';
        shareContainer.id = 'social-share-bar';

        const pageUrl = encodeURIComponent(window.location.href);
        const pageTitle = encodeURIComponent(document.title);
        const pageDescription = encodeURIComponent(
            document.querySelector('meta[name="description"]')?.content || document.title
        );

        // Get article image for Pinterest
        const ogImage = document.querySelector('meta[property="og:image"]')?.content || '';
        const pageImage = encodeURIComponent(ogImage);

        const shareButtons = [
            {
                name: 'Facebook',
                icon: '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>',
                url: `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}`,
                color: '#1877f2'
            },
            {
                name: 'Twitter',
                icon: '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>',
                url: `https://twitter.com/intent/tweet?url=${pageUrl}&text=${pageTitle}`,
                color: '#000000'
            },
            {
                name: 'Pinterest',
                icon: '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M12 0a12 12 0 0 0-4.373 23.178c-.07-.633-.134-1.606.028-2.298.146-.625.938-3.977.938-3.977s-.239-.479-.239-1.187c0-1.113.645-1.943 1.448-1.943.683 0 1.012.512 1.012 1.127 0 .687-.437 1.713-.663 2.664-.189.796.4 1.446 1.185 1.446 1.422 0 2.515-1.5 2.515-3.664 0-1.915-1.377-3.254-3.342-3.254-2.276 0-3.612 1.707-3.612 3.471 0 .688.265 1.425.595 1.826a.24.24 0 0 1 .056.23c-.061.252-.196.796-.222.907-.035.146-.116.177-.268.107-1-.465-1.624-1.926-1.624-3.1 0-2.523 1.834-4.84 5.286-4.84 2.775 0 4.932 1.977 4.932 4.62 0 2.757-1.739 4.976-4.151 4.976-.811 0-1.573-.421-1.834-.919l-.498 1.902c-.181.695-.669 1.566-.995 2.097A12 12 0 1 0 12 0z"/></svg>',
                url: `https://pinterest.com/pin/create/button/?url=${pageUrl}&media=${pageImage}&description=${pageTitle}`,
                color: '#e60023'
            },
            {
                name: 'LinkedIn',
                icon: '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>',
                url: `https://www.linkedin.com/shareArticle?mini=true&url=${pageUrl}&title=${pageTitle}`,
                color: '#0a66c2'
            },
            {
                name: 'WhatsApp',
                icon: '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 0 1-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 0 1-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 0 1 2.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0 0 12.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 0 0 5.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 0 0-3.48-8.413z"/></svg>',
                url: `https://wa.me/?text=${pageTitle}%20${pageUrl}`,
                color: '#25d366'
            },
            {
                name: 'Email',
                icon: '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>',
                url: `mailto:?subject=${pageTitle}&body=I thought you might find this interesting: ${pageUrl}`,
                color: '#666666'
            },
            {
                name: 'Copy Link',
                icon: '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>',
                url: '#copy',
                color: '#888888',
                isCopy: true
            }
        ];

        // Create label
        const label = document.createElement('div');
        label.className = 'share-label';
        label.textContent = 'SHARE';
        shareContainer.appendChild(label);

        // Create buttons
        shareButtons.forEach(btn => {
            const button = document.createElement('a');
            button.className = 'share-btn';
            button.style.setProperty('--btn-color', btn.color);
            button.innerHTML = btn.icon;
            button.title = btn.name;
            button.setAttribute('aria-label', `Share on ${btn.name}`);

            if (btn.isCopy) {
                button.href = '#';
                button.onclick = (e) => {
                    e.preventDefault();
                    copyLink(button);
                };
            } else {
                button.href = btn.url;
                button.target = '_blank';
                button.rel = 'noopener noreferrer';
            }

            shareContainer.appendChild(button);
        });

        document.body.appendChild(shareContainer);

        // Add scroll behavior
        handleScrollVisibility(shareContainer);
    }

    function createInlineShareButtons() {
        // Find article content area
        const articleContent = document.querySelector('.article-content') ||
            document.querySelector('.blog-article') ||
            document.querySelector('article');

        if (!articleContent) return;

        const pageUrl = encodeURIComponent(window.location.href);
        const pageTitle = encodeURIComponent(document.title);

        // Create inline share section at bottom of article
        const inlineShare = document.createElement('div');
        inlineShare.className = 'inline-share-section';
        inlineShare.innerHTML = `
            <div class="inline-share-header">
                <span class="share-icon">üì§</span>
                <span>Found this helpful? Share it!</span>
            </div>
            <div class="inline-share-buttons">
                <a href="https://www.facebook.com/sharer/sharer.php?u=${pageUrl}" target="_blank" rel="noopener" class="inline-share-btn facebook">
                    <span>Facebook</span>
                </a>
                <a href="https://twitter.com/intent/tweet?url=${pageUrl}&text=${pageTitle}" target="_blank" rel="noopener" class="inline-share-btn twitter">
                    <span>Twitter</span>
                </a>
                <a href="https://pinterest.com/pin/create/button/?url=${pageUrl}&description=${pageTitle}" target="_blank" rel="noopener" class="inline-share-btn pinterest">
                    <span>Pinterest</span>
                </a>
                <a href="https://wa.me/?text=${pageTitle}%20${pageUrl}" target="_blank" rel="noopener" class="inline-share-btn whatsapp">
                    <span>WhatsApp</span>
                </a>
            </div>
        `;

        // Insert before FAQ or at end of article
        const faqSection = articleContent.querySelector('.faq-section');
        if (faqSection) {
            faqSection.parentNode.insertBefore(inlineShare, faqSection);
        } else {
            articleContent.appendChild(inlineShare);
        }
    }

    function handleScrollVisibility(container) {
        let lastScrollY = window.scrollY;

        window.addEventListener('scroll', () => {
            const scrollY = window.scrollY;
            const docHeight = document.documentElement.scrollHeight;
            const viewHeight = window.innerHeight;

            // Show after scrolling 300px
            if (scrollY > 300) {
                container.classList.add('visible');
            } else {
                container.classList.remove('visible');
            }

            // Hide near footer
            if (scrollY + viewHeight > docHeight - 200) {
                container.classList.add('near-footer');
            } else {
                container.classList.remove('near-footer');
            }

            lastScrollY = scrollY;
        });
    }

    function copyLink(button) {
        navigator.clipboard.writeText(window.location.href).then(() => {
            const originalIcon = button.innerHTML;
            button.innerHTML = '<svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
            button.style.background = '#27ae60';

            setTimeout(() => {
                button.innerHTML = originalIcon;
                button.style.background = '';
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy:', err);
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = window.location.href;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
        });
    }

    function injectStyles() {
        const style = document.createElement('style');
        style.textContent = `
            /* Floating Social Share Bar */
            .social-share-floating {
                position: fixed;
                left: 20px;
                top: 50%;
                transform: translateY(-50%);
                display: flex;
                flex-direction: column;
                gap: 8px;
                background: white;
                padding: 15px 10px;
                border-radius: 30px;
                box-shadow: 0 5px 30px rgba(0,0,0,0.15);
                z-index: 1000;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }
            
            .social-share-floating.visible {
                opacity: 1;
                visibility: visible;
            }
            
            .social-share-floating.near-footer {
                opacity: 0.3;
            }
            
            .social-share-floating .share-label {
                font-size: 10px;
                font-weight: 600;
                color: #999;
                text-align: center;
                letter-spacing: 1px;
                margin-bottom: 5px;
            }
            
            .social-share-floating .share-btn {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                background: #f5f5f5;
                color: #666;
                text-decoration: none;
                transition: all 0.3s ease;
            }
            
            .social-share-floating .share-btn:hover {
                background: var(--btn-color, #666);
                color: white;
                transform: scale(1.1);
            }
            
            .social-share-floating .share-btn svg {
                width: 18px;
                height: 18px;
            }
            
            /* Inline Share Section */
            .inline-share-section {
                background: linear-gradient(135deg, #f8f9fa, #e9ecef);
                border-radius: 20px;
                padding: 30px;
                margin: 40px 0;
                text-align: center;
            }
            
            .inline-share-header {
                font-size: 1.2rem;
                font-weight: 600;
                color: #333;
                margin-bottom: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
            }
            
            .inline-share-header .share-icon {
                font-size: 1.5rem;
            }
            
            .inline-share-buttons {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 12px;
            }
            
            .inline-share-btn {
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 12px 24px;
                border-radius: 30px;
                text-decoration: none;
                font-weight: 600;
                color: white;
                transition: all 0.3s ease;
            }
            
            .inline-share-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            }
            
            .inline-share-btn.facebook { background: #1877f2; }
            .inline-share-btn.twitter { background: #000000; }
            .inline-share-btn.pinterest { background: #e60023; }
            .inline-share-btn.whatsapp { background: #25d366; }
            
            /* Hide floating bar on mobile, keep inline */
            @media (max-width: 1200px) {
                .social-share-floating {
                    left: 10px;
                    padding: 10px 8px;
                }
                
                .social-share-floating .share-btn {
                    width: 36px;
                    height: 36px;
                }
                
                .social-share-floating .share-label {
                    display: none;
                }
            }
            
            @media (max-width: 768px) {
                .social-share-floating {
                    display: none;
                }
                
                .inline-share-btn {
                    padding: 10px 18px;
                    font-size: 0.9rem;
                }
            }
            
            /* Remove old social share styles if exist */
            .social-share:not(.social-share-floating) {
                display: none !important;
            }
        `;
        document.head.appendChild(style);
    }

    // Initialize
    function init() {
        injectStyles();
        createFloatingShareBar();
        createInlineShareButtons();
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
// FAQ Accordion Functionality
(function() {
    'use strict';
    
    function initFAQ() {
        const questions = document.querySelectorAll('.faq-question');
        
        questions.forEach(question => {
            question.addEventListener('click', function() {
                const answer = this.nextElementSibling;
                const isActive = this.classList.contains('active');
                
                // Close all other FAQs
                document.querySelectorAll('.faq-question').forEach(q => {
                    q.classList.remove('active');
                    q.nextElementSibling.classList.remove('active');
                });
                
                // Toggle current FAQ
                if (!isActive) {
                    this.classList.add('active');
                    answer.classList.add('active');
                }
            });
        });
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initFAQ);
    } else {
        initFAQ();
    }
})();
// Site Search Functionality
(function () {
    'use strict';

    const articles = [
        {
            title: "2026 Feng Shui Forecast: Year of the Fire Horse",
            url: "article-2026-forecast.html",
            excerpt: "Discover your 2026 feng shui forecast with lucky directions, colors, and zodiac predictions for the Year of the Fire Horse.",
            keywords: "2026 forecast fire horse zodiac predictions lucky colors directions"
        },
        {
            title: "Office Feng Shui: Complete Guide to Workplace Success",
            url: "article-office-fengshui.html",
            excerpt: "Optimize your office with feng shui for career success. Learn desk placement, plants, and productivity tips.",
            keywords: "office desk workplace career success productivity plants"
        },
        {
            title: "Bedroom Feng Shui: Complete Guide for Better Sleep",
            url: "article-bedroom-fengshui.html",
            excerpt: "Transform your bedroom with feng shui for better sleep and romance. Bed placement, colors, and decor tips.",
            keywords: "bedroom sleep romance bed placement colors decor"
        },
        {
            title: "Kitchen Feng Shui: Complete Guide for Wealth & Health",
            url: "article-kitchen-fengshui.html",
            excerpt: "Create abundance in your kitchen with feng shui. Stove placement, colors, and organization for wealth and health.",
            keywords: "kitchen wealth health stove placement organization"
        },
        {
            title: "Living Room Feng Shui: Complete Guide for Wealth & Harmony",
            url: "article-living-room-fengshui.html",
            excerpt: "Transform your living room with feng shui. Sofa placement, coffee table, TV wall, and wealth corner activation.",
            keywords: "living room sofa coffee table tv wealth harmony"
        },
        {
            title: "Feng Shui Plants Guide: 15 Best Plants for Every Room",
            url: "article-plants-guide.html",
            excerpt: "Discover the 15 best feng shui plants. Money tree, lucky bamboo, jade plant, and complete care guide.",
            keywords: "plants money tree lucky bamboo jade plant care guide"
        },
        {
            title: "Daily Feng Shui Fortune",
            url: "daily-fortune.html",
            excerpt: "Check your daily feng shui fortune based on your Chinese zodiac. Get lucky colors, directions, and personalized tips.",
            keywords: "daily fortune zodiac luck predictions"
        }
    ];

    function createSearchBox() {
        const navWrapper = document.querySelector('.nav-wrapper');
        if (!navWrapper) return;

        // Create search container as a separate element
        const searchContainer = document.createElement('div');
        searchContainer.className = 'nav-search';
        searchContainer.innerHTML = `
            <div class="search-container">
                <input type="text" class="search-box" placeholder="Search..." id="siteSearch">
                <span class="search-icon">üîç</span>
                <div class="search-results" id="searchResults"></div>
            </div>
        `;

        // Insert before the nav-menu
        const navMenu = navWrapper.querySelector('.nav-menu');
        navWrapper.insertBefore(searchContainer, navMenu);

        const searchBox = document.getElementById('siteSearch');
        const searchResults = document.getElementById('searchResults');

        searchBox.addEventListener('input', function () {
            const query = this.value.trim().toLowerCase();

            if (query.length < 2) {
                searchResults.classList.remove('active');
                return;
            }

            const results = searchArticles(query);
            displayResults(results, query);
        });

        // Close results when clicking outside
        document.addEventListener('click', function (e) {
            if (!searchBox.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.classList.remove('active');
            }
        });
    }

    function searchArticles(query) {
        return articles.filter(article => {
            const searchText = `${article.title} ${article.excerpt} ${article.keywords}`.toLowerCase();
            return searchText.includes(query);
        }).slice(0, 5); // Limit to 5 results
    }

    function displayResults(results, query) {
        const searchResults = document.getElementById('searchResults');

        if (results.length === 0) {
            searchResults.innerHTML = '<div class="search-result-item">No results found</div>';
            searchResults.classList.add('active');
            return;
        }

        searchResults.innerHTML = results.map(article => {
            const highlightedTitle = highlightText(article.title, query);
            const highlightedExcerpt = highlightText(article.excerpt, query);

            return `
                <a href="${article.url}" class="search-result-item">
                    <div class="search-result-title">${highlightedTitle}</div>
                    <div class="search-result-excerpt">${highlightedExcerpt}</div>
                </a>
            `;
        }).join('');

        searchResults.classList.add('active');
    }

    function highlightText(text, query) {
        const regex = new RegExp(`(${query})`, 'gi');
        return text.replace(regex, '<span class="search-highlight">$1</span>');
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', createSearchBox);
    } else {
        createSearchBox();
    }
})();
// Enhanced Schema Markup Generator
// Automatically adds BreadcrumbList, WebSite, Organization, and improves Article schemas
(function () {
    'use strict';

    const SITE_CONFIG = {
        name: 'Feng Shui With Jackson',
        url: 'https://fengshuiwithjackson.com',
        description: 'Authentic Eastern Feng Shui guidance for modern homes. Transform your space, transform your life.',
        author: {
            name: 'Jackson Chen',
            url: 'https://fengshuiwithjackson.com'
        },
        logo: 'https://fengshuiwithjackson.com/images/logo.png',
        socialProfiles: [
            'https://www.facebook.com/fengshuiwithjackson',
            'https://www.pinterest.com/fengshuiwithjackson',
            'https://twitter.com/fengshui_jackson'
        ]
    };

    // Generate WebSite Schema (for homepage)
    function generateWebSiteSchema() {
        return {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "name": SITE_CONFIG.name,
            "url": SITE_CONFIG.url,
            "description": SITE_CONFIG.description,
            "potentialAction": {
                "@type": "SearchAction",
                "target": {
                    "@type": "EntryPoint",
                    "urlTemplate": `${SITE_CONFIG.url}/blog.html?search={search_term_string}`
                },
                "query-input": "required name=search_term_string"
            }
        };
    }

    // Generate Organization Schema
    function generateOrganizationSchema() {
        return {
            "@context": "https://schema.org",
            "@type": "Organization",
            "name": SITE_CONFIG.name,
            "url": SITE_CONFIG.url,
            "logo": SITE_CONFIG.logo,
            "description": SITE_CONFIG.description,
            "sameAs": SITE_CONFIG.socialProfiles,
            "founder": {
                "@type": "Person",
                "name": SITE_CONFIG.author.name
            },
            "contactPoint": {
                "@type": "ContactPoint",
                "contactType": "customer service",
                "availableLanguage": ["English", "Chinese"]
            }
        };
    }

    // Generate BreadcrumbList Schema
    function generateBreadcrumbSchema() {
        const path = window.location.pathname;
        const breadcrumbs = [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": SITE_CONFIG.url
            }
        ];

        // Determine page type and add appropriate breadcrumbs
        if (path.includes('article-')) {
            // Article page
            breadcrumbs.push({
                "@type": "ListItem",
                "position": 2,
                "name": "Blog",
                "item": `${SITE_CONFIG.url}/blog.html`
            });

            // Get article title
            const title = document.querySelector('h1')?.textContent ||
                document.title.split('|')[0].trim();
            breadcrumbs.push({
                "@type": "ListItem",
                "position": 3,
                "name": title,
                "item": window.location.href
            });
        } else if (path.includes('blog')) {
            breadcrumbs.push({
                "@type": "ListItem",
                "position": 2,
                "name": "Blog",
                "item": window.location.href
            });
        } else if (path.includes('shop')) {
            breadcrumbs.push({
                "@type": "ListItem",
                "position": 2,
                "name": "Shop",
                "item": window.location.href
            });
        } else if (path.includes('guide')) {
            breadcrumbs.push({
                "@type": "ListItem",
                "position": 2,
                "name": "Free Guide",
                "item": window.location.href
            });
        } else if (path.includes('daily-fortune') || path.includes('fortune-calculator')) {
            breadcrumbs.push({
                "@type": "ListItem",
                "position": 2,
                "name": "Fortune Tools",
                "item": window.location.href
            });
        }

        return {
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": breadcrumbs
        };
    }

    // Generate enhanced Article Schema
    function generateEnhancedArticleSchema() {
        const path = window.location.pathname;
        if (!path.includes('article-')) return null;

        // Check if article already has schema
        const existingSchema = document.querySelector('script[type="application/ld+json"]');
        if (existingSchema) {
            try {
                const data = JSON.parse(existingSchema.textContent);
                if (data['@type'] === 'Article') {
                    // Already has article schema, skip
                    return null;
                }
            } catch (e) { }
        }

        const title = document.querySelector('h1')?.textContent || document.title;
        const description = document.querySelector('meta[name="description"]')?.content || '';
        const image = document.querySelector('meta[property="og:image"]')?.content || '';
        const datePublished = document.querySelector('meta[property="article:published_time"]')?.content ||
            new Date().toISOString().split('T')[0];

        // Extract reading time from page
        const readingTimeMatch = document.body.textContent.match(/(\d+)\s*min\s*read/i);
        const wordCount = document.querySelector('.article-content')?.textContent.split(/\s+/).length || 2000;

        return {
            "@context": "https://schema.org",
            "@type": "Article",
            "headline": title,
            "description": description,
            "image": image,
            "author": {
                "@type": "Person",
                "name": SITE_CONFIG.author.name,
                "url": SITE_CONFIG.author.url
            },
            "publisher": {
                "@type": "Organization",
                "name": SITE_CONFIG.name,
                "logo": {
                    "@type": "ImageObject",
                    "url": SITE_CONFIG.logo
                }
            },
            "datePublished": datePublished,
            "dateModified": datePublished,
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": window.location.href
            },
            "wordCount": wordCount,
            "articleSection": "Feng Shui",
            "inLanguage": "en-US"
        };
    }

    // Generate ItemList Schema for blog page
    function generateBlogListSchema() {
        const path = window.location.pathname;
        if (!path.includes('blog')) return null;

        const articles = document.querySelectorAll('.blog-card');
        if (!articles.length) return null;

        const items = [];
        articles.forEach((card, index) => {
            const link = card.querySelector('a[href*="article-"]');
            const title = card.querySelector('h3')?.textContent || '';

            if (link && title) {
                items.push({
                    "@type": "ListItem",
                    "position": index + 1,
                    "item": {
                        "@type": "Article",
                        "name": title,
                        "url": new URL(link.href, window.location.origin).href
                    }
                });
            }
        });

        if (!items.length) return null;

        return {
            "@context": "https://schema.org",
            "@type": "ItemList",
            "name": "Feng Shui Articles",
            "description": "In-depth feng shui guides for every room and topic",
            "numberOfItems": items.length,
            "itemListElement": items
        };
    }

    // Generate Product Schema for shop page
    function generateShopSchema() {
        const path = window.location.pathname;
        if (!path.includes('shop')) return null;

        const products = document.querySelectorAll('.product-card');
        if (!products.length) return null;

        const items = [];
        products.forEach((card, index) => {
            const name = card.querySelector('h4')?.textContent || '';
            const link = card.querySelector('a[href*="amazon"]') || card.querySelector('a[href*="amzn"]');

            if (name && link) {
                items.push({
                    "@type": "ListItem",
                    "position": index + 1,
                    "item": {
                        "@type": "Product",
                        "name": name,
                        "url": link.href
                    }
                });
            }
        });

        if (!items.length) return null;

        return {
            "@context": "https://schema.org",
            "@type": "ItemList",
            "name": "Feng Shui Products",
            "description": "Curated feng shui products for wealth, health, and harmony",
            "numberOfItems": items.length,
            "itemListElement": items
        };
    }

    // Inject schema into page
    function injectSchema(schema) {
        if (!schema) return;

        const script = document.createElement('script');
        script.type = 'application/ld+json';
        script.textContent = JSON.stringify(schema, null, 2);
        document.head.appendChild(script);
    }

    // Check if schema already exists
    function schemaExists(type) {
        const scripts = document.querySelectorAll('script[type="application/ld+json"]');
        for (const script of scripts) {
            try {
                const data = JSON.parse(script.textContent);
                if (data['@type'] === type) return true;
                if (Array.isArray(data['@graph'])) {
                    if (data['@graph'].some(item => item['@type'] === type)) return true;
                }
            } catch (e) { }
        }
        return false;
    }

    // Initialize all schemas
    function init() {
        const path = window.location.pathname;
        const isHomepage = path === '/' || path === '/index.html' || path.endsWith('/');

        // Always add BreadcrumbList (if not on homepage)
        if (!isHomepage && !schemaExists('BreadcrumbList')) {
            injectSchema(generateBreadcrumbSchema());
        }

        // Add WebSite schema on homepage
        if (isHomepage && !schemaExists('WebSite')) {
            injectSchema(generateWebSiteSchema());
        }

        // Add Organization schema on homepage
        if (isHomepage && !schemaExists('Organization')) {
            injectSchema(generateOrganizationSchema());
        }

        // Add enhanced Article schema if missing
        if (path.includes('article-')) {
            const articleSchema = generateEnhancedArticleSchema();
            if (articleSchema) {
                injectSchema(articleSchema);
            }
        }

        // Add ItemList schema for blog
        if (path.includes('blog') && !schemaExists('ItemList')) {
            injectSchema(generateBlogListSchema());
        }

        // Add ItemList schema for shop
        if (path.includes('shop') && !schemaExists('ItemList')) {
            injectSchema(generateShopSchema());
        }

        console.log('Schema markup enhanced');
    }

    // Run after DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
/**
 * Luxury Visual Effects & Micro-interactions
 * Feng Shui With Jackson
 */

(function () {
    'use strict';

    document.addEventListener('DOMContentLoaded', init);

    function init() {
        createCustomCursor();
        initParticles();
        setupAuraCards();
        initSmoothReveal();
    }

    /**
     * 1. Custom Mouse Follower (Cursor)
     */
    function createCustomCursor() {
        if (window.innerWidth < 768) return; // Desktop only

        const cursor = document.createElement('div');
        const dot = document.createElement('div');
        cursor.className = 'custom-cursor';
        dot.className = 'custom-cursor-dot';
        document.body.appendChild(cursor);
        document.body.appendChild(dot);

        let mouseX = 0;
        let mouseY = 0;
        let cursorX = 0;
        let cursorY = 0;
        let dotX = 0;
        let dotY = 0;

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        const animate = () => {
            // Smoothler (lerp) for cursor
            cursorX += (mouseX - cursorX) * 0.15;
            cursorY += (mouseY - cursorY) * 0.15;
            cursor.style.left = `${cursorX}px`;
            cursor.style.top = `${cursorY}px`;
            cursor.style.transform = `translate(-50%, -50%)`;

            // Instant for dot
            dotX += (mouseX - dotX) * 1;
            dotY += (mouseY - dotY) * 1;
            dot.style.left = `${dotX}px`;
            dot.style.top = `${dotY}px`;
            dot.style.transform = `translate(-50%, -50%)`;

            requestAnimationFrame(animate);
        };
        animate();

        // Hover effect
        const links = document.querySelectorAll('a, button, .btn, .category-btn, .blog-card');
        links.forEach(link => {
            link.addEventListener('mouseenter', () => cursor.classList.add('hover'));
            link.addEventListener('mouseleave', () => cursor.classList.remove('hover'));
        });

        // Hide cursor when leaving window
        document.addEventListener('mouseleave', () => {
            cursor.style.opacity = '0';
            dot.style.opacity = '0';
        });
        document.addEventListener('mouseenter', () => {
            cursor.style.opacity = '1';
            dot.style.opacity = '1';
        });
    }

    /**
     * 2. Sublte Floating Particles
     */
    function initParticles() {
        const container = document.createElement('div');
        container.className = 'particles-container';
        document.body.appendChild(container);

        const particleCount = 20;
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';

            // Random position and delay
            const size = Math.random() * 4 + 2;
            particle.style.width = `${size}px`;
            particle.style.height = `${size}px`;
            particle.style.left = `${Math.random() * 100}%`;
            particle.style.animationDelay = `${Math.random() * 20}s`;
            particle.style.animationDuration = `${Math.random() * 10 + 15}s`;

            container.appendChild(particle);
        }
    }

    /**
     * 3. Aura Card Mouse Effects
     */
    function setupAuraCards() {
        const cards = document.querySelectorAll('.blog-card, .service-card, .calculator-box');

        cards.forEach(card => {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                card.style.setProperty('--mouse-x', `${x}px`);
                card.style.setProperty('--mouse-y', `${y}px`);

                // Tilt effect (subtle)
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                const rotateX = (y - centerY) / 20;
                const rotateY = (centerX - x) / 20;

                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateY(-5px)`;
            });

            card.addEventListener('mouseleave', () => {
                card.style.transform = '';
            });
        });
    }

    /**
     * 4. Smooth Intersection Reveal
     */
    function initSmoothReveal() {
        const observerOptions = {
            threshold: 0.15,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('premium-reveal-active');
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        const revealElements = document.querySelectorAll('h1, h2, .blog-card, .service-card, .problem-card, .section-title');
        revealElements.forEach(el => {
            el.classList.add('premium-reveal');
            observer.observe(el);
        });
    }

})();
/**
 * Global Lazy Loading & Performance Optimization
 * Feng Shui With Jackson
 * 
 * Features:
 * - Native lazy loading for all images
 * - Intersection Observer for background images
 * - Preload critical resources
 */

(function () {
    'use strict';

    document.addEventListener('DOMContentLoaded', init);

    function init() {
        applyNativeLazyLoading();
        setupBackgroundLazyLoading();
        setupImageFadeIn();
    }

    /**
     * Apply native lazy loading to all images
     */
    function applyNativeLazyLoading() {
        const images = document.querySelectorAll('img:not([loading])');

        images.forEach(img => {
            // Skip images that are already in viewport or above fold
            const rect = img.getBoundingClientRect();
            const isAboveFold = rect.top < window.innerHeight;

            if (!isAboveFold) {
                img.setAttribute('loading', 'lazy');
                img.setAttribute('decoding', 'async');
            }
        });

        console.log(`[LazyLoad] Applied lazy loading to ${images.length} images`);
    }

    /**
     * Lazy load background images using Intersection Observer
     */
    function setupBackgroundLazyLoading() {
        // Elements that commonly have background images
        const selectors = [
            '.blog-image',
            '.article-hero',
            '.page-header',
            '.hero-section',
            '[data-bg]',
            '.service-card',
            '.testimonial-bg'
        ];

        const elements = document.querySelectorAll(selectors.join(', '));

        if (!elements.length) return;

        if ('IntersectionObserver' in window) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const el = entry.target;

                        // Handle data-bg attribute
                        if (el.dataset.bg) {
                            el.style.backgroundImage = `url('${el.dataset.bg}')`;
                        }

                        // Add loaded class for fade-in effect
                        el.classList.add('bg-loaded');
                        observer.unobserve(el);
                    }
                });
            }, {
                rootMargin: '200px 0px',
                threshold: 0.01
            });

            elements.forEach(el => {
                // Only observe if has background or data-bg
                const hasBg = el.style.backgroundImage || el.dataset.bg;
                if (hasBg) {
                    el.classList.add('bg-lazy');
                    observer.observe(el);
                }
            });
        } else {
            // Fallback: just show all backgrounds
            elements.forEach(el => {
                if (el.dataset.bg) {
                    el.style.backgroundImage = `url('${el.dataset.bg}')`;
                }
                el.classList.add('bg-loaded');
            });
        }
    }

    /**
     * Add fade-in effect to lazy loaded images
     */
    function setupImageFadeIn() {
        // Add styles for fade-in effect
        const style = document.createElement('style');
        style.textContent = `
            /* Lazy loading fade-in */
            img[loading="lazy"] {
                opacity: 0;
                transition: opacity 0.4s ease-in-out;
            }

            img[loading="lazy"].loaded,
            img.loaded {
                opacity: 1;
            }

            /* Background lazy loading */
            .bg-lazy {
                opacity: 0;
                transition: opacity 0.5s ease-in-out;
            }

            .bg-lazy.bg-loaded {
                opacity: 1;
            }

            /* Placeholder while loading */
            .bg-lazy:not(.bg-loaded) {
                background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            }
        `;
        document.head.appendChild(style);

        // Listen for image load events
        document.querySelectorAll('img[loading="lazy"]').forEach(img => {
            if (img.complete) {
                img.classList.add('loaded');
            } else {
                img.addEventListener('load', () => {
                    img.classList.add('loaded');
                });
            }
        });
    }

})();
